import{M as $,N as e,R as J,O as Fe,P as Ye,d as Ve,Q as be,S as fe,T as ge,U as We}from"./vendor-react-Dc2o_H4k.js";import{C as ae,t as r,g as V,P as Ee,a as $e,b as te,c as ke,d as Re,e as _e,f as qe,h as Te,i as re,j as ne,k as le,l as ie,m as oe,n as Ne,R as Ke,o as Xe}from"./game-core-C_gBomU2.js";import{r as ve}from"./vendor-Ct8sJpkz.js";import{b as Qe}from"./vendor-visuals-BQkZI2F5.js";const ce=2,De=20;function Je(t){if(Number.isNaN(t))return ce;const s=Math.round(t);return Math.min(De,Math.max(ce,s))}function Ze(t,s){if(Number.isNaN(t))return 1;const c=Math.round(t),a=Math.max(1,s-1);return Math.min(Math.max(1,c),a)}function se(t){if(t<=0)return 1;const s=Math.floor((t+2)/2)-1,c=Math.max(1,t-1);return Math.min(Math.max(s,1),c)}const Rt=({dispatch:t,language:s})=>{const[c,a]=$.useState(1),[o,j]=$.useState(7),[u,i]=$.useState(()=>se(7)),[x,I]=$.useState([]),[p,A]=$.useState(()=>{const w={};return Object.values(ae).forEach(h=>w[h.id]=h.defaultAmount),w}),R="mafia-button mafia-button--jade font-bold tracking-[0.3em] uppercase py-3 px-8 rounded-2xl text-lg";if(c===1)return e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsxs("div",{className:"setup-panel text-white items-center text-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:r("setup_step_count",s)}),e.jsx("input",{type:"number",min:ce,max:De,value:o,onChange:w=>{const h=Je(Number(w.target.value));j(h),i(se(h))},className:"mafia-input text-3xl text-center w-32 font-bold tracking-[0.2em]"}),e.jsxs("button",{onClick:()=>{a(2)},className:R,children:[r("setup_next",s)," â†’"]})]})});if(c===2){const h=Math.max(1,o-1),v=se(o),d=g=>{i(Ze(g,o))};return e.jsx("div",{className:"w-full max-w-xl mx-auto",children:e.jsxs("div",{className:"setup-panel text-white",children:[e.jsx("h2",{className:"text-2xl font-bold",children:r("setup_step_mafia",s)}),e.jsx("p",{className:"text-center text-[rgba(255,255,255,0.75)]",children:r("setup_mafia_description",s,{min:1,max:h})}),e.jsxs("div",{className:"rounded-2xl border border-[rgba(242,200,121,0.25)] bg-[rgba(4,4,8,0.88)] p-5 flex flex-col gap-4 shadow-[inset_0_0_30px_rgba(0,0,0,0.35)]",children:[e.jsxs("div",{className:"flex items-center justify-between text-lg font-semibold",children:[e.jsx("span",{children:r("setup_mafia_label",s)}),e.jsx("span",{className:"text-4xl font-bold text-[var(--color-brass)]",children:u})]}),e.jsx("input",{type:"range",min:1,max:h,value:u,onChange:g=>d(Number(g.target.value)),className:"w-full accent-[var(--color-brass)]"}),e.jsx("p",{className:"text-sm text-slate-300 text-center",children:r("setup_mafia_recommended",s,{players:o,count:v})})]}),e.jsxs("button",{onClick:()=>{I(Array(o).fill("")),a(3)},className:R,children:[r("setup_next",s)," â†’"]})]})})}if(c===3)return e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsxs("div",{className:"setup-panel text-white",children:[e.jsx("h2",{className:"text-2xl font-bold",children:r("setup_step_names",s)}),e.jsx("div",{className:"flex flex-col gap-2 max-h-[60vh] w-full overflow-y-auto pr-1",children:x.map((w,h)=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"w-8 text-right font-mono text-[rgba(255,255,255,0.55)]",children:[h+1,"."]}),e.jsx("input",{type:"text",value:w,onChange:v=>{const d=[...x];d[h]=v.target.value,I(d)},className:"mafia-input flex-1 text-base"})]},h))}),e.jsxs("button",{onClick:()=>{A(w=>({...w,Mafia:u})),a(4)},className:R,children:[r("setup_next",s)," â†’"]})]})});const E=Object.values(p).reduce((w,h)=>w+h,0),M=E%o,f=Math.max(0,o-E),n=M===0?0:M,m=M===0?f:o-M,l=f===0,b=M===0&&l,y=b?"mafia-button mafia-button--jade text-xs sm:text-sm font-black tracking-[0.25em] uppercase px-5 py-3 rounded-xl shadow-lg":"px-5 py-3 rounded-xl font-black text-xs sm:text-sm tracking-[0.25em] uppercase bg-[rgba(18,16,26,0.85)] text-slate-500 border border-[rgba(255,255,255,0.08)] cursor-not-allowed shadow-lg",N=w=>{const h=w==="Mafia"?1:0;A(v=>{const d=v[w]??0;return d<=h?v:{...v,[w]:d-1}})},_=w=>{A(h=>{const v=h[w]??0;return{...h,[w]:v+1}})},k=()=>{const w=[];Object.entries(p).forEach(([h,v])=>{for(let d=0;d<v;d++)w.push(h)}),t({type:"START_GAME",payload:{names:x,customDeck:w,language:s}})};return e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6 text-white w-full max-w-5xl mx-auto h-full min-h-0",children:[e.jsx("h2",{className:"text-2xl font-bold text-center",children:r("setup_step_balance",s)}),e.jsxs("div",{className:"setup-balance-shell",children:[e.jsxs("div",{className:"setup-balance-toolbar",children:[e.jsxs("div",{className:"setup-panel__metrics",role:"group","aria-label":r("setup_step_balance",s),children:[e.jsxs("div",{className:`setup-metric-card ${n===0?"setup-metric-card--ok":"setup-metric-card--warn"}`,children:[e.jsx("div",{className:"setup-metric-card__value",children:n}),e.jsx("div",{children:r("setup_cards_remaining",s)})]}),e.jsxs("div",{className:`setup-metric-card ${m===0?"setup-metric-card--ok":"setup-metric-card--pending"}`,children:[e.jsx("div",{className:"setup-metric-card__value",children:m}),e.jsx("div",{children:r("setup_cards_missing",s)})]})]}),e.jsx("button",{onClick:()=>{b&&k()},disabled:!b,className:`${y} setup-balance-toolbar__button transition-colors duration-150`,children:r("setup_start_game",s)})]}),e.jsxs("div",{className:"setup-balance-content",children:[e.jsxs("div",{className:"setup-panel text-center text-white",children:[e.jsx("p",{className:"text-lg text-[rgba(242,200,121,0.9)]",children:r("setup_balance_instruction",s,{remove:n,add:m})}),e.jsx("div",{className:"text-sm text-slate-300",children:r("setup_cards_total",s,{count:E,players:o})}),!l&&e.jsx("div",{className:"text-sm text-yellow-300",children:r("setup_cards_minimum",s,{missing:f})})]}),e.jsx("div",{className:"setup-card-grid w-full p-1 sm:p-2",children:Object.values(ae).map(w=>{const h=w.id,v=p[h]??0,g=v>(h==="Mafia"?1:0);return e.jsxs("div",{className:"setup-card-tile",children:[e.jsx("span",{className:"setup-card-title",children:V(h,s)}),e.jsxs("div",{className:"setup-card-actions",children:[e.jsx("button",{type:"button",onClick:()=>N(h),className:`setup-adjust setup-adjust--remove ${g?"":"setup-adjust--disabled"}`,disabled:!g,"aria-label":`${V(h,s)} -`,children:"-"}),e.jsx("span",{className:"setup-card-count",children:v}),e.jsx("button",{type:"button",onClick:()=>_(h),className:"setup-adjust setup-adjust--add","aria-label":`${V(h,s)} +`,children:"+"})]})]},h)})})]})]})]})},et=({player:t,x:s,y:c,phase:a,isActive:o,onClick:j,disabled:u=!1,size:i=1,isHighlighted:x=!1,communistSuppressionActive:I=!1,showMatrixIcon:p=!1})=>{const A=a.includes("NIGHT"),R=!t.status.isAlive,E=u?.4:R?.5:1,M=u?"cursor-not-allowed":"cursor-pointer",f=Math.min(Ee,Math.max($e,i)),n=4*f,m=3*f,l=1.5*f,b=l*1.25,y=Math.min(.95,Math.max(.6,.68+(f-1)*.25)),N=$.useRef(null),_=o?"border-[rgba(242,200,121,0.85)]":"border-[rgba(242,200,121,0.35)]",k=o?"shadow-[0_22px_42px_rgba(0,0,0,0.75)]":"shadow-[0_12px_28px_rgba(0,0,0,0.55)]",w=x?"ring-4 ring-[rgba(242,200,121,0.6)] ring-offset-2 ring-offset-[rgba(8,6,12,0.85)] animate-pulse":"";$.useLayoutEffect(()=>{const v=N.current;if(!v)return;const d=v.parentElement;if(!d)return;let g=y;const C=Math.max(.3,y*.45);v.style.fontSize=`${g}rem`;for(let T=0;T<20;T++){const D=v.scrollWidth>d.clientWidth-4,H=v.scrollHeight>d.clientHeight-4;if(!D&&!H||g<=C)break;g=Math.max(C,g-.05),v.style.fontSize=`${g}rem`}},[t.name,y,f]);const h=p&&A&&t.status.isAlive;return e.jsxs("div",{className:`absolute flex flex-col items-center justify-center transition ${M} ${o?"scale-110 z-20":"z-10"}`,style:{left:`${s}%`,top:`${c}%`,width:`${n}rem`,height:`${n}rem`,transform:"translate(-50%, -50%)",opacity:E,filter:R?"grayscale(100%)":"none",pointerEvents:u?"none":void 0},onClick:u?void 0:()=>j(t.id),"aria-disabled":u,children:[e.jsx("div",{className:`rounded-full border-2 flex items-center justify-center transition-all duration-200 ${_} ${k} ${w}`,style:{width:`${m}rem`,height:`${m}rem`,background:"radial-gradient(circle at 35% 25%, rgba(242, 200, 121, 0.15), rgba(8, 6, 12, 0.92))"},children:e.jsx("span",{ref:N,className:"text-xs font-bold max-w-full px-1 text-center leading-tight text-[rgba(255,255,255,0.95)]",style:{fontSize:`${y}rem`,whiteSpace:"nowrap"},children:t.name})}),A&&t.status.isAlive&&e.jsxs(e.Fragment,{children:[h&&e.jsx("img",{src:"/icons/matrix.jpg",className:"absolute -bottom-2 -left-2",style:{height:`${b}rem`,width:"auto",maxWidth:`${b*1.4}rem`,objectFit:"contain"},alt:"Matrix activated"}),t.status.isSlimed&&e.jsx("img",{src:"/icons/slime.png",className:"absolute -top-2 -right-2",style:{width:`${l}rem`,height:`${l}rem`}}),t.status.isSanded&&e.jsx("img",{src:"/icons/sand.png",className:"absolute -top-2 -right-2",style:{width:`${l}rem`,height:`${l}rem`}}),t.status.isMagnetized&&e.jsx("img",{src:"/icons/magnet.png",className:"absolute -bottom-2 -right-2",style:{width:`${l}rem`,height:`${l}rem`}})]}),!A&&t.status.isAlive&&!I&&e.jsxs(e.Fragment,{children:[t.cards.some(v=>v.cardId==="Meciar")&&e.jsx("img",{src:"/icons/meciar.png",className:"absolute -top-2 -right-2",style:{width:`${l}rem`,height:`${l}rem`}}),t.cards.some(v=>v.cardId==="Kovac")&&e.jsx("img",{src:"/icons/kovac.png",className:"absolute -top-2 -left-2",style:{width:`${l}rem`,height:`${l}rem`}})]}),!A&&t.status.isAlive&&e.jsxs(e.Fragment,{children:[t.status.isCantVote&&e.jsx("img",{src:"/icons/cant_vote.png",className:"absolute -bottom-2 -left-2",style:{width:`${l}rem`,height:`${l}rem`}}),t.status.isSilenced&&e.jsx("img",{src:"/icons/silenced.png",className:"absolute -bottom-2 left-1/2 -translate-x-1/2",style:{width:`${l}rem`,height:`${l}rem`}})]})]})},ye=[{beam:"rgba(197, 83, 61, 0.8)",highlight:"rgba(242, 200, 121, 0.95)",capFill:"rgba(36, 18, 14, 0.9)",capStroke:"rgba(242, 200, 121, 0.55)"},{beam:"rgba(123, 198, 140, 0.85)",highlight:"rgba(222, 255, 235, 0.95)",capFill:"rgba(9, 24, 19, 0.92)",capStroke:"rgba(137, 227, 179, 0.65)"},{beam:"rgba(124, 134, 182, 0.85)",highlight:"rgba(227, 233, 255, 0.95)",capFill:"rgba(18, 21, 34, 0.92)",capStroke:"rgba(139, 148, 190, 0.6)"}],F=t=>`${t}%`,je=16,we=()=>{if(typeof window>"u")return je;const t=parseFloat(window.getComputedStyle(document.documentElement).fontSize);return Number.isFinite(t)?t:je},tt=({tunnels:t,positions:s,playerNodeScale:c,tableSizePx:a})=>{const o=$.useRef(null),u=`tunnel-glow-${$.useId()}`,[i,x]=$.useState(()=>we());$.useEffect(()=>{if(typeof window>"u")return;const f=()=>x(we());return window.addEventListener("resize",f),f(),()=>window.removeEventListener("resize",f)},[]),$.useEffect(()=>{if(typeof window>"u")return;const f=o.current;if(!f)return;let n,m=0;const l=()=>{m-=.4,f.style.setProperty("--tunnel-flow-offset",m.toString()),f.style.setProperty("--tunnel-highlight-offset",(m*1.4).toString()),n=window.requestAnimationFrame(l)};return n=window.requestAnimationFrame(l),()=>window.cancelAnimationFrame(n)},[]);const I=f=>s.find(n=>n.id===f),p=$.useMemo(()=>Math.min(Ee,Math.max($e,c)),[c]),A=$.useMemo(()=>a?3*p*i/2/a*100:null,[p,i,a]),R=A??5,E=A??5,M=(f,n)=>{const m=n.x-f.x,l=n.y-f.y,b=Math.hypot(m,l)||1,y=Math.min(R,b/2),N=Math.min(E,b/2),_=f.x+m*y/b,k=f.y+l*y/b,w=n.x-m*N/b,h=n.y-l*N/b;return{startX:_,startY:k,endX:w,endY:h}};return e.jsxs("svg",{ref:o,className:"tunnel-layer absolute inset-0 w-full h-full pointer-events-none z-0",children:[e.jsx("defs",{children:e.jsxs("filter",{id:u,x:"-40%",y:"-40%",width:"180%",height:"180%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2.1",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),t.map((f,n)=>{const m=I(f.sourceId),l=I(f.targetId);if(!m||!l)return null;const b=ye[n%ye.length],{startX:y,startY:N,endX:_,endY:k}=M(m,l),w=.85+n%4*.18,h={"--tunnel-speed":w.toFixed(2)},v={"--tunnel-highlight-speed":(w*1.35).toFixed(2)};return e.jsxs("g",{className:"tunnel-layer__tunnel",filter:`url(#${u})`,children:[e.jsx("line",{className:"tunnel-layer__beam",x1:F(y),y1:F(N),x2:F(_),y2:F(k),stroke:b.beam,strokeWidth:3.2,style:h}),e.jsx("line",{className:"tunnel-layer__beam tunnel-layer__beam--highlight",x1:F(y),y1:F(N),x2:F(_),y2:F(k),stroke:b.highlight,strokeWidth:1.8,style:v}),e.jsx("circle",{className:"tunnel-layer__cap",cx:F(y),cy:F(N),r:"1.5",fill:b.capFill,stroke:b.capStroke,strokeWidth:1.2}),e.jsx("circle",{className:"tunnel-layer__cap tunnel-layer__cap--target",cx:F(_),cy:F(k),r:"1.8",fill:b.capFill,stroke:b.highlight,strokeWidth:1.4})]},f.id)})]})};function Se(t,s){const c=t.segments.find(a=>a.fromId)?.fromId??null;return t.sourceId??c??s}function st(t){const s=new Map;t.forEach(a=>{a.segments.length&&(s.has(a.shotId)||s.set(a.shotId,[]),s.get(a.shotId).push(a))});const c=[];return s.forEach((a,o)=>{const j=Se(a[0],null),u=[];a.forEach(i=>{let x=u;const I=Se(i,j),p=i.segments.length?i.segments.map(A=>({...A})):[];p.length?!p[0].fromId&&I&&(p[0].fromId=I):I&&p.push({fromId:I,toId:I}),p.forEach(A=>{if(!A.toId)return;const R=A.fromId??I??null;let E=x.find(M=>M.fromId===R&&M.toId===A.toId);E||(E={fromId:R,toId:A.toId,children:[]},x.push(E)),x=E.children})}),u.length&&c.push({shotId:o,sourceId:j,roots:u})}),c}const at=({animations:t,positions:s,bulletSpeed:c})=>{const[a,o]=$.useState([]),j=$.useMemo(()=>{const i=new Map;return s.forEach(x=>{i.set(x.id,{x:x.x,y:x.y})}),i},[s]),u=$.useMemo(()=>st(t),[t]);return $.useEffect(()=>{if(!u.length){o([]);return}let i=!1;const x=[],I=[],p=Math.max(200,c),A=Math.max(60,Math.round(p*.1)),R=N=>N?j.get(N):null,E=(N,_)=>{o(k=>k.find(h=>h.id===N)?k.map(h=>h.id===N?{...h,x:_.x,y:_.y,duration:p}:h):[...k,{id:N,x:_.x,y:_.y,duration:p}])},M=N=>{o(_=>_.filter(k=>k.id!==N))},f=N=>new Promise(_=>{const k=window.setTimeout(_,N);x.push(k)}),n=(N,_,k)=>new Promise(w=>{E(N,_);const h=window.requestAnimationFrame(()=>{const v=window.requestAnimationFrame(()=>{o(g=>g.map(C=>C.id===N?{...C,x:k.x,y:k.y,duration:p}:C));const d=window.setTimeout(()=>w(),p);x.push(d)});I.push(v)});I.push(h)});let m=0;const l=async(N,_,k)=>{if(i)return;const w=R(N.toId);if(!w){M(_);return}const h=R(N.fromId??k)??w;if(await n(_,h,w),i)return;if(!N.children.length){await f(A),M(_);return}await f(A);const[v,...d]=N.children,g=N.toId,C=[l(v,_,g)];d.forEach(T=>{const D=`${_}-branch-${m++}`;E(D,w),C.push(l(T,D,g))}),await Promise.all(C)},b=async N=>{const _=N.roots.map((k,w)=>{const h=k.fromId??N.sourceId,v=R(h)??R(k.toId);if(!v)return Promise.resolve();const d=`${N.shotId}-root-${w}`;return E(d,v),l(k,d,h??k.toId??null)});await Promise.all(_),await f(A*2)};return(async()=>{for(const N of u){if(i)break;await b(N)}o([])})(),()=>{i=!0,x.forEach(clearTimeout),I.forEach(cancelAnimationFrame),o([])}},[u,c,j]),u.length?e.jsx("div",{className:"absolute inset-0 pointer-events-none z-20",children:a.map(i=>e.jsx("div",{className:"absolute mafia-bullet",style:{left:`${i.x}%`,top:`${i.y}%`,transition:`left ${i.duration}ms linear, top ${i.duration}ms linear`}},i.id))}):null},ee=t=>{if(!t)return 0;const s=parseFloat(t);return Number.isFinite(s)?s:0},Ce=t=>{if(!t||typeof window>"u")return 0;const s=window.getComputedStyle(t);return ee(s.paddingTop)+ee(s.paddingBottom)+ee(s.borderTopWidth)+ee(s.borderBottomWidth)},Tt=({players:t,phase:s,selectedId:c,onSelect:a,tunnels:o,disabledPlayerIds:j,playerNodeScale:u,onTableSizeChange:i,highlightedPlayerIds:x,communistSuppressionActive:I=!1,bulletAnimations:p,bulletSpeed:A,bulletReplayNonce:R,matrixTrapPlayerId:E=null})=>{const M=$.useRef(null),[f,n]=$.useState(0),m=$.useRef(null);$.useLayoutEffect(()=>{const v=M.current;if(!v)return;const d=()=>{const C=v.getBoundingClientRect(),T=Math.min(C.width,C.height),D=Ce(v.parentElement),H=T+D;m.current!==H&&(m.current=H,i?.(H)),n(B=>B===T?B:T)};if(d(),typeof ResizeObserver>"u")return typeof window<"u"?(window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)):void 0;const g=new ResizeObserver(C=>{const T=C[0];if(!T)return;const{width:D,height:H}=T.contentRect,B=Math.min(D,H),G=Ce(v.parentElement),z=B+G;m.current!==z&&(m.current=z,i?.(z)),n(Q=>Q===B?Q:B)});return g.observe(v),()=>g.disconnect()},[i]);const l=$.useMemo(()=>{const T=(()=>{if(!f)return 0;const B=280,G=560,z=Math.max(B,Math.min(G,f));return(G-z)/(G-B)*3})(),D=Math.max(0,u-1)*1.5,H=38-T-D+1.25;return Math.min(41,Math.max(33,H))},[f,u]),b=$.useMemo(()=>{if(!f)return 1;const v=260,d=560;return f>=d?1:1-(d-f)/(d-v)*(1-.78)},[f]),y=$.useMemo(()=>t.map((v,d)=>{const g=d/t.length*2*Math.PI-Math.PI/2;return{...v,x:50+l*Math.cos(g),y:50+l*Math.sin(g)}}),[t,l]),N=s==="DAY_ANNOUNCEMENT"||s==="DAY_MAIN",_=s==="NIGHT_REPLAY"&&!!p?.length,k=_?p??[]:[],w=A??500,h=R??0;return e.jsx("div",{ref:M,className:"relative w-full h-full flex items-center justify-center",children:e.jsxs("div",{className:"relative max-w-full max-h-full aspect-square mafia-table rounded-full",style:f?{width:f,height:f}:{width:"min(80vw, 520px)",height:"min(80vw, 520px)"},children:[!N&&e.jsx(tt,{tunnels:o,positions:y,playerNodeScale:u,tableSizePx:f}),_&&e.jsx(at,{animations:k,positions:y,bulletSpeed:w},h),y.map(v=>e.jsx(et,{player:v,x:v.x,y:v.y,phase:s,isActive:c===v.id,onClick:a,disabled:j?.has(v.id)??!1,size:u,isHighlighted:!!x?.has(v.id),communistSuppressionActive:I,showMatrixIcon:E===v.id},v.id)),e.jsx("div",{className:"mafia-table__center-badge absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-2xl",style:{fontSize:`${1.5*b}rem`},children:"MAFIAÂ²"})]})})},rt="inline-flex items-center gap-1 leading-tight rounded-full border",nt={default:"px-2 py-0.5 text-[var(--color-brass)] border-[rgba(242,200,121,0.25)] bg-[rgba(242,200,121,0.08)]",gmActive:"px-2 py-0.2 text-slate-50 border-[rgba(242,200,121,0.28)] bg-[rgba(242,200,121,0.12)] shadow-[0_4px_15px_rgba(0,0,0,0.25)]",gmInactive:"px-2 py-0.5 text-[rgba(255,255,255,0.4)] border-[rgba(197,83,61,0.35)] bg-[rgba(197,83,61,0.18)]",logSegment:"pl-1 pr-2 py-0.5 border-[rgba(242,200,121,0.25)] bg-[rgba(242,200,121,0.06)] text-[0.85rem] font-medium relative top-[1.5px]",inline:"px-2 py-0.5 border-[rgba(242,200,121,0.2)] bg-[rgba(242,200,121,0.04)] text-current"},lt={xs:"h-5 w-5",sm:"h-6 w-6",md:"h-7 w-7"},it={xs:"h-3 w-3",sm:"h-4 w-4",md:"h-5 w-5"},Z=({cardId:t,label:s,size:c="sm",variant:a="default",className:o="",labelClassName:j="",inlineAlign:u})=>{const i=te(t),x=lt[c],I=it[c],p=`${x} inline-flex self-center shrink-0 items-center justify-center rounded-full border border-[rgba(242,200,121,0.35)] bg-[rgba(15,12,20,0.65)] text-[var(--color-brass)]`,E=`${rt} ${(u??(a==="logSegment"?"baseline":"middle"))==="baseline"?"align-baseline":"align-middle"} ${nt[a]} ${o}`.trim();return e.jsxs("span",{className:E,title:s,children:[i?e.jsx("span",{className:p,"aria-hidden":!0,children:J.createElement(i,{className:I,weight:"duotone"})}):e.jsx("span",{className:`${p} text-[0.65rem]`,"aria-hidden":!0,children:"?"}),e.jsx("span",{className:j,children:s})]})},Dt=({state:t,dispatch:s,fullHeight:c=!1})=>{const a=t.settings.language,o=$.useMemo(()=>ke(t.players,a),[t.players,a]),j=t.phase==="NIGHT_ANNOUNCEMENT"&&t.currentRound===1&&!t.firstNightBriefingDone,u=t.uiState.pendingDayReport,i=!!u?.length,x=t.phase==="DAY_ANNOUNCEMENT"||t.phase==="GAME_OVER"||i,I=t.phase==="DAY_ANNOUNCEMENT",p=t.phase==="DAY_MAIN",A=t.phase==="NIGHT_REPLAY"&&!!t.nightCache.bulletAnimations?.length,R=$.useMemo(()=>t.players.filter(S=>S.status.isAlive),[t.players]),E=$.useMemo(()=>{const S=r("ui_special_no_owner",a),O=(P,q)=>{const Y=P.cards.findIndex(K=>K.cardId===q);return(Y>=0?o[P.id]?.[Y]:void 0)||V(q,a)},L=(P,q)=>{const Y=R.filter(W=>W.cards.some(Ue=>Ue.cardId===P)).map(W=>({player:W,label:O(W,P)})),K=Y.filter(W=>q(W.player)),pe=K.length?K:Y,ze=pe.length?pe.map(W=>`${W.label} (${W.player.name})`).join(", "):S;return{ready:K.length>0,text:ze}};return{anarchist:L("Anarchist",P=>!P.status.anarchistShotUsed),terrorist:L("Terrorist",P=>!P.status.terroristBombUsed),astronomer:L("Astronomer",P=>!P.status.astronomerNightUsed),communist:L("Communist",P=>!P.status.communistEqualityUsed)}},[R,o,a]),M=$.useMemo(()=>t.players.some(S=>S.status.isAlive&&!S.status.timeLordSkipUsed&&S.cards.some(O=>O.cardId==="TimeLord")),[t.players]),f=$.useMemo(()=>{const S=V("TimeLord",a),O=t.players.find(Y=>Y.status.isAlive&&!Y.status.timeLordSkipUsed&&Y.cards.some(K=>K.cardId==="TimeLord"));if(!O)return S;const L=O.cards.findIndex(Y=>Y.cardId==="TimeLord");if(L<0)return S;const P=O.cards[L].instance,q=P!=null?`${S} ${P}`:S;return o[O.id]?.[L]??q},[t.players,o,a]),n=E.anarchist.ready,m=E.terrorist.ready,l=E.astronomer.ready,b=E.communist.ready,y=M&&t.phase==="NIGHT_ANNOUNCEMENT"&&!j,N=M&&I,_=!!t.uiState.dayAction||i,k=t.uiState.dayAction?.kind==="HANG",w=!l||i||!!t.uiState.dayAction&&!k,h=t.activeCard?.cardId==="Spyglass",v="mafia-button font-bold text-center w-full h-full flex items-center justify-center tracking-[0.2em] uppercase shadow-[0_12px_25px_rgba(0,0,0,0.55)] rounded-xl overflow-hidden min-h-[3.25rem] sm:min-h-[4rem] px-4 py-3",d=`${v} mafia-button--chronos-day`,g=`${v} mafia-button--chronos-night`,C="mafia-button mafia-button--ember font-bold tracking-[0.2em] uppercase",T="flex-1 mafia-button rounded-xl font-bold tracking-[0.2em] uppercase shadow-[0_12px_20px_rgba(0,0,0,0.45)] w-full min-h-[3.25rem] sm:min-h-[4rem] px-4 py-3",D=t.activeCard?(()=>{for(const S of t.players){const O=S.cards.findIndex(L=>L.cardId===t.activeCard.cardId&&L.instance===t.activeCard.instance);if(O>=0)return{label:o[S.id]?.[O]??`${V(S.cards[O].cardId,a)} ${S.cards[O].instance}`,playerName:S.name,playerId:S.id}}return null})():null,H=D?t.players.some(S=>S.id===D.playerId&&S.status.isJailed):!1,B=t.uiState.pendingPrompts[0],G=D?.label||(t.activeCard?r(`role_${t.activeCard.cardId}`,a):void 0),z=G?{role:G}:void 0,Q=B&&t.activeCard?z:void 0,Pe=t.activeCard?.mode==="MATRIX_SHOT"?(()=>{const S=t.nightCache.matrixStoredBullets,O=t.nightCache.reportData?.matrixBulletsCaught??0,L=Math.max(1,Math.max(S,O));return{current:Math.min(L,Math.max(1,L-S+1)),total:L}})():void 0,de=t.phase==="NIGHT_REPLAY"?r("ui_bullet_replay",a):p?r("day_idle_message",a):r("start_night_intro",a),me=j?`${de}
${r("first_night_message",a)}`:t.activeCard?h?r("wake_up_spyglass",a):t.activeCard.mode==="MATRIX_SHOT"?r("wake_matrix_shot",a,Pe??{current:1,total:1}):B?r(B,a,Q):r("wake_up",a,z):B?r(B,a):de,ue=$.useMemo(()=>{if(!h)return null;const S=D?.playerId??null,L=(t.nightCache.spyglassRevealIds??[]).filter(P=>P!==S).map(P=>t.players.find(q=>q.id===P)?.name).filter(P=>!!P);return L.length?r("spyglass_reveal_intro",a,{names:L.join(", ")}):r("spyglass_reveal_none",a)},[h,t.nightCache.spyglassRevealIds,D?.playerId,t.players,a]),xe=i?u||[]:t.phase==="DAY_ANNOUNCEMENT"||t.phase==="GAME_OVER"?t.publicReport:[],Be=S=>(S.fragments?.length?S.fragments:[S]).flatMap(L=>Re(L.key,L.params,t.players,a)),Oe=(S,O)=>S.map((L,P)=>L.kind==="cardLabel"?e.jsx(Z,{cardId:L.cardId,label:L.label,size:"xs",variant:"logSegment",className:"mx-0.5"},`${O}-card-${P}`):e.jsx(J.Fragment,{children:L.text},`${O}-text-${P}`));let U=null;if(t.phase==="GAME_OVER")U=null;else if(t.uiState.waitingFor==="USE_DECISION")U=e.jsxs("div",{className:"flex gap-2 h-full",children:[e.jsx("button",{onClick:()=>s({type:"GM_USE_DECISION",payload:!0}),className:`${T} mafia-button--jade`,children:r("ui_confirm",a)}),!h&&e.jsx("button",{onClick:()=>s({type:"GM_USE_DECISION",payload:!1}),className:`${T} mafia-button--crimson`,children:r("ui_deny",a)})]});else if(j)U=e.jsx("button",{onClick:()=>s({type:"NEXT_PHASE"}),className:`${C} p-3 rounded-xl`,children:r("ui_first_night_done",a)});else if(I){const S=e.jsx("button",{onClick:()=>s({type:"NEXT_PHASE"}),className:`${C} p-3 rounded-xl`,children:r("start_day",a)});N?U=e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[S,e.jsx("button",{onClick:()=>s({type:"TRIGGER_TIMELORD_SKIP",payload:{targetPhase:"DAY"}}),className:d,children:r("ui_timelord_skip_day",a,{cardLabel:f})})]}):U=S}else if(p)if(i)U=e.jsx("button",{onClick:()=>s({type:"CONFIRM_DAY_REPORT"}),className:`${C} p-3 rounded-xl`,children:r("day_report_confirm",a)});else if(t.uiState.dayAction?.kind==="MASS_MURDERER_RETALIATION"){const S=t.uiState.dayAction.massMurderer?.ownerId,O=S?t.players.find(P=>P.id===S):null,L=t.uiState.dayAction.massMurderer?.selectedIds.length??0;U=e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"bg-[rgba(4,4,8,0.85)] border border-[rgba(242,200,121,0.25)] p-3 rounded-2xl text-center text-sm shadow-inner",children:[e.jsx("div",{className:"font-semibold",children:r(t.uiState.dayAction.promptKey,a)}),O&&e.jsx("div",{className:"text-xs text-slate-200 mt-1",children:r("ui_mass_murderer_target",a,{name:O.name})}),e.jsx("div",{className:"text-xs text-slate-200 mt-1",children:r("ui_mass_murderer_selected",a,{count:L})})]}),e.jsx("button",{onClick:()=>s({type:"CONFIRM_MASS_MURDERER"}),className:"w-full p-3 rounded-xl font-bold bg-[#c1121f] uppercase tracking-[0.2em] shadow-[0_15px_30px_rgba(0,0,0,0.55)]",children:r("ui_mass_murderer_confirm",a)})]})}else{const S="w-full h-full p-3 rounded-xl font-semibold tracking-[0.2em] uppercase disabled:opacity-40 disabled:cursor-not-allowed flex flex-col items-center justify-center text-center break-words hyphens-auto gap-1 text-xs shadow-[0_12px_25px_rgba(0,0,0,0.35)] overflow-hidden";U=e.jsxs("div",{className:"grid grid-cols-3 grid-rows-2 gap-2 auto-rows-fr",children:[e.jsx("button",{onClick:()=>s({type:"NEXT_PHASE"}),disabled:_,className:`${C} ${S}`,children:r("ui_start_night",a)}),e.jsxs("button",{onClick:()=>s({type:"TRIGGER_BOMB"}),disabled:_||!m,className:`${S} mafia-button mafia-button--bomb`,children:[e.jsx("span",{children:r("ui_bomb",a)}),e.jsx("span",{className:"text-[0.55rem] text-white/80 leading-tight normal-case tracking-normal",children:E.terrorist.text})]}),e.jsxs("button",{onClick:()=>s({type:"TRIGGER_ANARCHIST"}),disabled:_||!n,className:`${S} mafia-button mafia-button--anarchist`,children:[e.jsx("span",{children:r("ui_anarchist_baby",a)}),e.jsx("span",{className:"text-[0.55rem] text-slate-100 leading-tight normal-case tracking-normal",children:E.anarchist.text})]}),e.jsx("button",{onClick:()=>s({type:"TRIGGER_VOTE"}),disabled:_,className:`${S} mafia-button mafia-button--vote`,children:r("day_action_vote",a)}),e.jsxs("button",{onClick:()=>s({type:"TRIGGER_ASTRONOMER"}),disabled:w,className:`${S} mafia-button mafia-button--astronomer`,children:[e.jsx("span",{children:r("ui_astronomer_night",a)}),e.jsx("span",{className:"text-[0.55rem] text-slate-100 leading-tight normal-case tracking-normal",children:E.astronomer.text})]}),e.jsxs("button",{onClick:()=>s({type:"TRIGGER_COMMUNIST"}),disabled:!b||_,className:`${S} mafia-button mafia-button--communist`,children:[e.jsx("span",{children:r("ui_communist_equal",a)}),e.jsx("span",{className:"text-[0.55rem] text-slate-100 leading-tight normal-case tracking-normal",children:E.communist.text})]})]})}else if(t.phase!=="NIGHT_ACTIVE"){const S=e.jsxs("button",{onClick:()=>s({type:"NEXT_PHASE"}),className:"bg-[#1f1e27] border border-[rgba(242,200,121,0.2)] p-3 rounded-xl font-bold tracking-[0.2em] uppercase",children:[r("ui_next_phase",a)," â†’"]});A?U=e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>s({type:"REPLAY_BULLETS"}),className:"mafia-button mafia-button--bullet-replay p-3 rounded-xl font-bold tracking-[0.2em] uppercase overflow-hidden",children:r("ui_replay_bullets",a)}),S]}):y?U=e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[S,e.jsx("button",{onClick:()=>s({type:"TRIGGER_TIMELORD_SKIP",payload:{targetPhase:"NIGHT"}}),className:g,children:r("ui_timelord_skip_night",a,{cardLabel:f})})]}):U=S}const he="mafia-panel text-white p-4 shadow-2xl flex flex-col md:flex-row gap-4 border border-[rgba(242,200,121,0.12)] backdrop-blur",He=c?`${he} flex-1 min-h-0 overflow-y-auto`:`${he} flex-shrink-0`;return e.jsxs("div",{className:He,children:[e.jsx("div",{className:"flex flex-col w-full md:flex-1",children:e.jsx("div",{className:"bg-[rgba(4,4,8,0.92)] p-4 rounded-2xl text-lg border-l-4 border-[var(--color-bullet)] shadow-inner overflow-y-auto md:flex-1",children:x?e.jsxs("div",{className:"space-y-2",children:[!i&&xe.length===0&&e.jsx("div",{className:"font-bold",children:r("public_report_default",a)}),xe.map((S,O)=>{const L=Be(S);return e.jsx("div",{className:"text-base",children:Oe(L,`control-report-${O}`)},`${S.key}-${O}`)})]}):t.activeCard?e.jsxs("div",{children:[e.jsx("div",{className:`font-bold ${H?"text-red-400":""}`,children:me}),D?.playerName&&(H?e.jsx("div",{className:"text-sm text-red-300 mt-1",children:r("ui_player_jailed_notice",a,{name:D.playerName})}):e.jsx("div",{className:"text-sm text-slate-200 mt-1",children:r("ui_player_label",a,{name:D.playerName})})),h&&ue&&e.jsx("div",{className:"text-sm text-slate-200 mt-1",children:ue})]}):me})}),e.jsxs("div",{className:"flex flex-col gap-2 w-full md:w-[30rem]",children:[U,e.jsx("div",{className:"flex gap-1 mt-auto",children:e.jsx("button",{onClick:()=>s({type:"UNDO"}),className:"flex-1 bg-[#2f2c3b] text-xs py-2 rounded-xl tracking-[0.3em] uppercase text-slate-100",children:r("ui_undo",a)})})]})]})},ot={NIGHT_START:"border-[rgba(242,200,121,0.45)] text-[var(--color-brass)] bg-[rgba(242,200,121,0.08)]",NIGHT_END:"border-[rgba(242,200,121,0.2)] text-[rgba(242,200,121,0.75)] bg-[rgba(242,200,121,0.04)]",DAY_START:"border-[rgba(197,83,61,0.45)] text-[rgba(255,202,170,0.9)] bg-[rgba(197,83,61,0.08)]",DAY_END:"border-[rgba(197,83,61,0.18)] text-[rgba(255,202,170,0.75)] bg-[rgba(197,83,61,0.04)]"},Ie={log_divider_night_start:"NIGHT_START",log_divider_night_end:"NIGHT_END",log_divider_day_start:"DAY_START",log_divider_day_end:"DAY_END"},ct={NIGHT_START:"log_divider_night_start",NIGHT_END:"log_divider_night_end",DAY_START:"log_divider_day_start",DAY_END:"log_divider_day_end"},dt=["NIGHT_ANNOUNCEMENT","NIGHT_ACTIVE","NIGHT_REPLAY"],mt=["DAY_ANNOUNCEMENT","DAY_MAIN"],ut=t=>dt.includes(t)?"NIGHT":mt.includes(t)?"DAY":"OTHER",X=(t,s,c,a)=>({kind:"divider",variant:t,text:r(ct[t],s,c!=null?{round:c}:void 0),key:a}),xt=({logs:t,players:s,language:c,className:a,title:o="",emptyMessage:j=""})=>{const u=t.slice(),i="h-full flex flex-col rounded-2xl bg-[rgba(14,12,18,0.85)] border border-[rgba(242,200,121,0.18)] shadow-[inset_0_0_30px_rgba(0,0,0,0.45)]",x=a?`${i} ${a}`:i,I=$.useRef(null),p=n=>n==="NIGHT_START"||n==="DAY_START",A=u.some(n=>{const m=n.translationKey?Ie[n.translationKey]:void 0;return m?p(m):!1}),R=(n,m,l)=>e.jsxs("div",{className:"text-[0.58rem] uppercase tracking-[0.45em] text-[rgba(242,200,121,0.65)] flex items-center gap-2",children:[e.jsx("span",{className:"h-px flex-1 bg-[rgba(242,200,121,0.2)]","aria-hidden":"true"}),e.jsx("span",{className:`px-3 py-1 rounded-full border ${ot[m]}`,children:l}),e.jsx("span",{className:"h-px flex-1 bg-[rgba(242,200,121,0.2)]","aria-hidden":"true"})]},n),E=n=>{const m=qe(n,s,c),l=n.type==="DEATH"?"text-[rgba(197,83,61,0.9)]":"text-slate-100";return e.jsx("div",{className:l,children:m.length?m.map((b,y)=>b.kind==="cardLabel"?e.jsx(Z,{cardId:b.cardId,label:b.label,size:"xs",variant:"logSegment",className:"mx-0.5"},`${n.id}-segment-${y}`):e.jsx(J.Fragment,{children:b.text},`${n.id}-segment-${y}`)):_e(n,s,c)},n.id)},M=[];if(!A){let n=null,m=null;u.forEach(l=>{const b=ut(l.phase);b!==n&&(n==="NIGHT"&&m!=null?M.push(X("NIGHT_END",c,m,`${l.id}-night-end`)):n==="DAY"&&m!=null&&M.push(X("DAY_END",c,m,`${l.id}-day-end`)),b==="NIGHT"?(M.push(X("NIGHT_START",c,l.round,`${l.id}-night-start`)),m=l.round):b==="DAY"?(M.push(X("DAY_START",c,l.round,`${l.id}-day-start`)),m=l.round):m=null,n=b),M.push({kind:"log",entry:l})}),n==="NIGHT"&&m!=null?M.push(X("NIGHT_END",c,m,`fallback-night-end-${m}`)):n==="DAY"&&m!=null&&M.push(X("DAY_END",c,m,`fallback-day-end-${m}`))}const f=A?u.map(n=>{const m=n.translationKey?Ie[n.translationKey]:void 0;return m?R(n.id,m,_e(n,s,c)):E(n)}):M.map(n=>n.kind==="divider"?R(n.key,n.variant,n.text):E(n.entry));return $.useEffect(()=>{const n=I.current;n&&(n.scrollTop=n.scrollHeight)},[u.length]),e.jsxs("div",{className:x,children:[e.jsx("div",{className:"px-4 py-3 border-b border-[rgba(242,200,121,0.15)] text-[0.65rem] font-semibold uppercase tracking-[0.4em] text-[var(--color-brass)]/85",children:o}),e.jsxs("div",{ref:I,className:"flex-1 overflow-y-auto p-4 space-y-3 text-sm text-slate-100/90",children:[u.length===0&&e.jsx("div",{className:"text-[rgba(242,200,121,0.55)]",children:j}),f]})]})},Lt=({activeTab:t,setTab:s,isGm:c,language:a})=>{const o=A=>`flex-1 flex flex-col items-center justify-center gap-1 py-2 px-1 transition-colors ${t===A?"text-[var(--color-brass)]":"text-slate-400 hover:text-white/90"}`,j="calc(4rem + var(--safe-area-bottom, env(safe-area-inset-bottom, 0px)))",u="tracking-[0.18em] uppercase",i=`text-[0.6rem] ${u}`,x=`text-[0.55rem] ${u}`,I="transition-transform duration-200 drop-shadow-[0_3px_8px_rgba(0,0,0,0.45)]",p=A=>({size:22,weight:t===A?"fill":"regular",className:I});return e.jsx("div",{className:"mafia-nav fixed inset-x-0 bottom-0 w-full flex z-50 text-white",style:{height:j,paddingBottom:"var(--safe-area-bottom, env(safe-area-inset-bottom, 0px))"},children:c?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>s("GAME"),className:o("GAME"),"data-active":t==="GAME",children:[e.jsx(Fe,{...p("GAME"),"aria-hidden":!0}),e.jsx("span",{className:i,children:r("nav_game",a)})]}),e.jsxs("button",{onClick:()=>s("PLAYERS"),className:o("PLAYERS"),"data-active":t==="PLAYERS",children:[e.jsx(Ye,{...p("PLAYERS"),"aria-hidden":!0}),e.jsx("span",{className:i,children:r("nav_players",a)})]}),e.jsxs("button",{onClick:()=>s("LOGS"),className:o("LOGS"),"data-active":t==="LOGS",children:[e.jsx(Ve,{...p("LOGS"),"aria-hidden":!0}),e.jsx("span",{className:i,children:r("nav_logs",a)})]}),e.jsxs("button",{onClick:()=>s("RULES"),className:o("RULES"),"data-active":t==="RULES",children:[e.jsx(be,{...p("RULES"),"aria-hidden":!0}),e.jsx("span",{className:i,children:r("nav_rules",a)})]}),e.jsxs("button",{onClick:()=>s("CARDS"),className:o("CARDS"),"data-active":t==="CARDS",children:[e.jsx(fe,{...p("CARDS"),"aria-hidden":!0}),e.jsx("span",{className:i,children:r("nav_cards",a)})]}),e.jsxs("button",{onClick:()=>s("SETTINGS"),className:o("SETTINGS"),"data-active":t==="SETTINGS",children:[e.jsx(ge,{...p("SETTINGS"),"aria-hidden":!0}),e.jsx("span",{className:i,children:r("nav_settings",a)})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>s("GAME"),className:o("GAME"),"data-active":t==="GAME",children:[e.jsx(We,{...p("GAME"),"aria-hidden":!0}),e.jsx("span",{className:x,children:r("nav_my_cards",a)})]}),e.jsxs("button",{onClick:()=>s("CARDS"),className:o("CARDS"),"data-active":t==="CARDS",children:[e.jsx(fe,{...p("CARDS"),"aria-hidden":!0}),e.jsx("span",{className:x,children:r("nav_all_cards",a)})]}),e.jsxs("button",{onClick:()=>s("RULES"),className:o("RULES"),"data-active":t==="RULES",children:[e.jsx(be,{...p("RULES"),"aria-hidden":!0}),e.jsx("span",{className:x,children:r("nav_rules",a)})]}),e.jsxs("button",{onClick:()=>s("SETTINGS"),className:o("SETTINGS"),"data-active":t==="SETTINGS",children:[e.jsx(ge,{...p("SETTINGS"),"aria-hidden":!0}),e.jsx("span",{className:x,children:r("nav_settings",a)})]})]})})},ht=()=>e.jsx("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",role:"presentation","aria-hidden":"true",fill:"currentColor",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),pt=()=>e.jsxs("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",role:"presentation","aria-hidden":"true",fill:"none",stroke:"currentColor",strokeWidth:"1.75",children:[e.jsx("circle",{cx:"12",cy:"12",r:"4"}),e.jsx("path",{d:"M12 3v2m0 14v2m9-9h-2M5 12H3m15.364-6.364-1.414 1.414M7.05 16.95 5.636 18.364m12.728 0-1.414-1.414M7.05 7.05 5.636 5.636"})]}),bt=()=>e.jsxs("svg",{viewBox:"0 0 24 24",className:"h-5 w-5",role:"presentation","aria-hidden":"true",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M8 15v3.5a4 4 0 0 0 8 0V15"}),e.jsx("path",{d:"M7 9a5 5 0 0 1 10 0v3.5A2.5 2.5 0 0 1 14.5 15h-5A2.5 2.5 0 0 1 7 12.5V9Z"}),e.jsx("circle",{cx:"9",cy:"9.5",r:"1.3"}),e.jsx("circle",{cx:"15",cy:"9.5",r:"1.3"}),e.jsx("path",{d:"M9 18.5a3 3 0 0 0 6 0"})]}),ft={night:{label:"Night action",className:"text-[var(--color-brass)] border-[rgba(242,200,121,0.4)] bg-[rgba(242,200,121,0.08)]",Glyph:ht},day:{label:"Day action",className:"text-[rgba(255,188,150,0.95)] border-[rgba(197,83,61,0.45)] bg-[rgba(197,83,61,0.08)]",Glyph:pt},gas:{label:"Provides gas mask",className:"text-[#a9f5d0] border-[rgba(132,201,178,0.4)] bg-[rgba(132,201,178,0.08)]",Glyph:bt}},gt=({label:t,className:s,children:c})=>e.jsx("span",{className:`inline-flex h-9 w-9 min-h-[2.25rem] min-w-[2.25rem] items-center justify-center rounded-full border text-base shadow-[0_8px_20px_rgba(0,0,0,0.35)] ${s}`,title:t,"aria-label":t,children:c}),Ae="flex flex-col overflow-hidden rounded-2xl border border-[rgba(242,200,121,0.18)] bg-[rgba(14,12,18,0.9)]",Me="Description coming soon.",Le=({label:t,glyph:s,imageSrc:c,artMode:a,indicators:o=[],description:j,className:u})=>{const i=s,x=a==="icon",I=x?"":"min-h-[450px]",p=u?`${Ae} ${I} ${u}`:`${Ae} ${I}`,A=()=>e.jsx("div",{className:"flex items-center justify-center w-full h-full text-[rgba(242,200,121,0.5)] text-sm font-semibold tracking-[0.4em] uppercase",children:"No art yet"}),R="relative flex items-center justify-center flex-1 basis-0 min-h-0 max-h-[65%] p-4 border-b border-[rgba(242,200,121,0.15)]",E="bg-white",M=()=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[x&&e.jsx("div",{className:"flex h-14 w-14 flex-shrink-0 items-center justify-center rounded-xl border border-[rgba(242,200,121,0.25)] bg-[radial-gradient(circle_at_top,rgba(242,200,121,0.2),rgba(14,12,18,0.95))] shadow-[0_12px_25px_rgba(0,0,0,0.35)]",children:i?e.jsx(i,{className:"h-9 w-9 text-[var(--color-brass)]",weight:"duotone","aria-hidden":"true"}):e.jsx("span",{className:"text-[rgba(242,200,121,0.6)] text-[0.6rem] font-semibold tracking-[0.3em] uppercase",children:"No icon"})}),e.jsx("h3",{className:"text-lg font-bold text-[var(--color-brass)] leading-snug",children:t})]}),o.length>0&&e.jsx("div",{className:"flex flex-wrap items-center gap-2 text-white/80",children:o.map(f=>{const n=ft[f];return n?e.jsx(gt,{label:n.label,className:n.className,children:e.jsx(n.Glyph,{})},`${t}-${f}`):null})})]});return x?e.jsx("article",{className:p,children:e.jsxs("div",{className:"flex flex-col gap-3 p-4 shrink-0",children:[M(),e.jsx("p",{className:"text-sm text-slate-100/80 leading-relaxed py-1",children:j??Me})]})}):e.jsxs("article",{className:p,children:[e.jsx("div",{className:`${R} ${E}`,children:c?e.jsx("img",{src:c,alt:t,className:"object-contain h-full w-full",loading:"lazy"}):A()}),e.jsxs("div",{className:"flex flex-col gap-3 p-4 shrink-0",children:[M(),e.jsx("p",{className:"text-sm text-slate-100/80 flex-1 leading-relaxed py-1",children:j??Me})]})]})},_t=new TextEncoder,Nt=new TextDecoder,vt=t=>{let s="";return t.forEach(c=>{s+=String.fromCharCode(c)}),s},yt=t=>Uint8Array.from(t,s=>s.charCodeAt(0)),jt=t=>{const s=JSON.stringify(t),c=vt(_t.encode(s));return btoa(c)},wt=t=>{try{const s=atob(t),c=Nt.decode(yt(s));return JSON.parse(c)}catch{return null}};function St(){return $.useMemo(()=>{if(typeof window>"u")return null;const s=new URLSearchParams(window.location.search).get("data");return s?wt(s):null},[])}const Gt=({className:t,artMode:s,onArtModeChange:c,language:a})=>{const o=St(),j=a??o?.lang??"pl",u=r("player_link_invalid",j),i="h-full overflow-y-auto text-white px-3 pt-5 pb-24 sm:px-4 sm:pt-7",x=t?`${i} ${t}`:i,[I,p]=$.useState("icon"),A=s??I,R=c??(m=>p(m)),E="px-4 py-1.5 text-sm font-semibold rounded-xl transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-brass)]",M=[{value:"icon",label:r("cards_toggle_icons",j)},{value:"image",label:r("cards_toggle_images",j)}],f=$.useMemo(()=>{if(!o)return[];const{cards:m,labels:l=[]}=o,b=Te(j),y=r("cards_placeholder_description",j);return[...m.map((_,k)=>{const w=l[k]??`${V(_.cardId,j)} ${_.instance}`,h=[];return re(_.cardId)&&h.push("night"),ne(_.cardId)&&h.push("day"),le(_.cardId,_.instance)&&h.push("gas"),{card:_,label:w,icon:oe(_.cardId,_.instance),glyph:te(_.cardId),indicators:h,description:ie(_.cardId,j)??y}})].sort((_,k)=>_.label.localeCompare(k.label,b,{sensitivity:"base"}))},[o,j]);if(!o)return e.jsx("div",{className:`${x} flex flex-col items-center justify-center text-center`,children:e.jsx("p",{className:"text-white/80 text-sm",children:u})});const{name:n}=o;return e.jsx("div",{className:x,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("header",{className:"space-y-3",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-baseline gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold mafia-title text-[var(--color-brass)]",children:r("nav_my_cards",j)}),e.jsx("p",{className:"text-xs uppercase tracking-[0.35em] text-white/60",children:n})]}),e.jsx("div",{className:"inline-flex items-center gap-1 rounded-2xl border border-[rgba(242,200,121,0.3)] bg-[rgba(16,14,20,0.85)] p-1 self-center sm:self-auto",children:M.map(m=>{const l=A===m.value;return e.jsx("button",{type:"button",onClick:()=>R(m.value),"aria-pressed":l,className:`${E} ${l?"bg-[var(--color-brass)] text-[rgba(20,14,10,0.9)] shadow-[0_10px_25px_rgba(0,0,0,0.35)]":"text-white/70 hover:text-white"}`,children:m.label},m.value)})})]})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4",children:f.map(({card:m,label:l,icon:b,glyph:y,indicators:N,description:_},k)=>e.jsx(Le,{label:l,glyph:y,imageSrc:b,artMode:A,indicators:N,description:_},`${m.cardId}-${m.instance}-${k}`))})]})})},Pt=({state:t})=>{const s=t.settings.language,c=$.useMemo(()=>ke(t.players,s),[t.players,s]),a=Te(s),o=typeof document<"u"?document.body:null,j=$.useMemo(()=>t.players.reduce((d,g)=>{const C=c[g.id]||[],T=g.cards.map((G,z)=>({card:G,label:C[z]??Ne(t.players,s,G.cardId,G.instance),isInactive:!1})),H=(g.inactiveCards||[]).map(G=>({card:G,label:Ne(t.players,s,G.cardId,G.instance),isInactive:!0})),B=[...T,...H].sort((G,z)=>G.isInactive!==z.isInactive?G.isInactive?1:-1:G.label.localeCompare(z.label,a,{sensitivity:"base"}));return d[g.id]={active:T,combined:B},d},{}),[c,a,t.players,s]),[u,i]=$.useState(null),[x,I]=$.useState(null),[p,A]=$.useState(!1),R="w-full min-w-[8rem] inline-flex items-center justify-center gap-2 rounded text-sm font-semibold px-3 py-2 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-0 focus-visible:ring-[rgba(242,200,121,0.35)] shadow-[0_12px_30px_rgba(0,0,0,0.35)]",E="p-4 rounded-2xl border flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between transition-colors backdrop-blur",M={townAlive:"bg-[rgba(15,12,20,0.82)] border-[rgba(242,200,121,0.18)]",townDead:"bg-[rgba(50,12,12,0.7)] border-[rgba(197,83,61,0.4)] text-slate-400",mafiaAlive:"bg-[rgba(33,8,16,0.9)] border-[rgba(255,90,104,0.55)] shadow-[0_0_30px_rgba(255,70,105,0.25)]",mafiaDead:"bg-[rgba(58,9,14,0.65)] border-[rgba(255,90,104,0.4)] text-slate-400",shareMode:"bg-[rgba(15,12,20,0.85)] border-[rgba(242,200,121,0.25)]"},f="inline-flex items-center gap-2 rounded-full border px-2 py-0.5 text-[0.6rem] font-semibold uppercase tracking-[0.3em] bg-[rgba(255,82,103,0.12)] border-[rgba(255,99,125,0.55)] text-[#ff9cae]",n=d=>r("gm_players_share_text",s,{player:d}),m=()=>typeof window>"u"?{available:!1,reason:"unsupported"}:window.isSecureContext||window.location.hostname==="localhost"?typeof navigator>"u"||typeof navigator.share!="function"?{available:!1,reason:"unsupported"}:{available:!0}:{available:!1,reason:"insecure-context"},l=(d,g)=>{if(typeof window>"u")return"";const C={name:d.name,cards:g.map(B=>B.card),lang:s,labels:g.map(B=>B.label)},T=jt(C),{origin:D,pathname:H}=window.location;return`${D}${H}?data=${T}`},b=(d,g)=>{const C={title:r("gm_players_share_title",s,{player:d}),text:n(d)};if(typeof window<"u"){const T=g.startsWith("https://"),D=/^https?:\/\/(localhost|127\.0\.0\.1)(:\\d+)?/i.test(g);if(T||D)return C.url=g,C}return C.text=`${C.text} ${g}`,C},y=async d=>{if(typeof navigator<"u"&&navigator.clipboard?.writeText)try{return await navigator.clipboard.writeText(d),!0}catch(g){console.error("Clipboard API write failed",g)}if(typeof document<"u"){const g=document.createElement("input");g.value=d,g.setAttribute("readonly",""),g.style.position="absolute",g.style.left="-9999px",g.style.fontSize="16px",document.body.appendChild(g),g.select(),g.setSelectionRange(0,d.length);try{const C=document.execCommand("copy");return document.body.removeChild(g),C}catch(C){document.body.removeChild(g),console.error("execCommand copy failed",C)}}return!1},N=async(d,g,C)=>await y(d)?(alert(r("gm_players_copy_success",s,{player:g})),!0):(I({playerName:g,url:d,reason:C}),!1),_=async(d,g)=>{const C=l(d,g);if(!C)return;const T=m();if(T.available){const H=b(d.name,C);try{await navigator.share(H);return}catch(B){if(B?.name==="AbortError")return;console.error("Web Share API failed",B),I({playerName:d.name,url:C,reason:r("gm_players_share_failure_reason",s)});return}}const D=T.reason==="insecure-context"?r("gm_players_share_insecure",s):r("gm_players_share_unsupported",s);await N(C,d.name,D)},k=async(d,g)=>{const C=l(d,g);if(C){i({playerName:d.name,url:C,dataUrl:null,isLoading:!0});try{const T=await Qe.toDataURL(C,{width:256,margin:1});i(D=>D&&D.url===C?{...D,dataUrl:T,isLoading:!1}:D)}catch(T){console.error("QR code generation failed",T),alert(r("gm_players_qr_error",s)),await N(C,d.name),i(null)}}},w=()=>i(null),h=()=>I(null),v=async()=>{if(!x)return;await y(x.url)&&(alert(r("gm_players_copy_success",s,{player:x.playerName})),I(null))};return e.jsxs("div",{className:"h-full overflow-y-auto text-white px-3 pt-6 pb-24 sm:px-4 sm:pt-8 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 mafia-title text-[var(--color-brass)]",children:r("gm_players_title",s,{count:t.players.length})}),e.jsxs("div",{className:"rounded-2xl border border-[rgba(242,200,121,0.15)] bg-[rgba(15,12,20,0.7)] p-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-[rgba(242,200,121,0.8)]",children:r("gm_players_share_mode_title",s)}),e.jsx("p",{className:"text-sm text-slate-200/80 mt-1",children:r("gm_players_share_mode_hint",s)})]}),e.jsxs("button",{type:"button",onClick:()=>A(d=>!d),"aria-pressed":p,className:`inline-flex items-center gap-3 rounded-2xl border px-4 py-2 font-semibold transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-0 focus-visible:ring-[rgba(242,200,121,0.35)] ${p?"border-[rgba(242,200,121,0.45)] text-[var(--color-brass)] bg-[rgba(242,200,121,0.08)]":"border-[rgba(242,200,121,0.2)] text-white bg-[rgba(10,8,14,0.85)] hover:border-[rgba(242,200,121,0.35)]"}`,children:[e.jsx("span",{className:`relative inline-flex h-6 w-12 items-center rounded-full transition ${p?"bg-[rgba(242,200,121,0.35)]":"bg-slate-600/60"}`,children:e.jsx("span",{className:`h-5 w-5 rounded-full bg-white transition ${p?"translate-x-6 bg-[var(--color-brass)]":"translate-x-1"}`,"aria-hidden":!0})}),e.jsx("span",{children:p?r("gm_players_share_mode_on",s):r("gm_players_share_mode_off",s)})]})]}),e.jsx("div",{className:"grid gap-3",children:t.players.map(d=>{const g=j[d.id]||{active:[],combined:[]},{active:C,combined:T}=g,H=[...d.cards,...d.inactiveCards??[]].some(G=>G.cardId==="Mafia"),B=p?M.shareMode:d.status.isAlive?H?M.mafiaAlive:M.townAlive:H?M.mafiaDead:M.townDead;return e.jsxs("div",{className:`${E} ${B} ${d.status.isAlive?"":"grayscale"}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("div",{className:"font-bold text-lg text-[var(--color-brass)]",children:d.name}),!p&&H&&e.jsxs("span",{className:f,children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-[#ff6b81]","aria-hidden":!0}),e.jsx("span",{children:r("gm_players_badge_mafia",s)})]})]}),p?e.jsx("div",{className:"text-sm text-[rgba(242,200,121,0.75)] italic",children:r("gm_players_share_mode_cards_hidden",s)}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-sm text-slate-200/85 flex flex-wrap gap-1.5",children:T.length?T.map((G,z)=>e.jsx(Z,{cardId:G.card.cardId,label:G.label,size:"sm",variant:G.isInactive?"gmInactive":"gmActive",labelClassName:G.isInactive?"line-through decoration-[rgba(197,83,61,0.65)] decoration-2":""},`${G.card.cardId}-${G.card.instance}-${z}`)):e.jsx("span",{className:"text-[rgba(242,200,121,0.55)] italic",children:r("gm_players_no_cards",s)})})})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full sm:w-48 sm:flex-none",children:[e.jsxs("button",{type:"button",onClick:()=>_(d,C),className:`${R} mafia-button mafia-button--ember`,children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ”—"}),r("gm_players_share_button",s)]}),e.jsxs("button",{type:"button",onClick:()=>k(d,C),className:`${R} border border-[rgba(242,200,121,0.35)] text-[var(--color-brass)] bg-[rgba(242,200,121,0.08)] hover:bg-[rgba(242,200,121,0.15)]`,children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ“±"}),r("gm_players_qr_button",s)]})]})]},d.id)})}),o&&u&&ve.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"relative max-w-sm w-full rounded-2xl border border-[rgba(242,200,121,0.25)] bg-[rgba(12,10,16,0.95)] p-6 text-center shadow-[0_25px_55px_rgba(0,0,0,0.7)]",children:[e.jsx("button",{type:"button","aria-label":r("gm_players_modal_close_qr_aria",s),className:"absolute right-3 top-3 rounded-full p-1 text-slate-400 transition hover:text-white",onClick:w,children:"âœ–"}),e.jsx("h3",{className:"text-xl font-semibold mb-1 text-[var(--color-brass)]",children:u.playerName}),e.jsx("p",{className:"text-sm text-[rgba(242,200,121,0.75)] mb-4",children:r("gm_players_qr_instruction",s)}),u.isLoading||!u.dataUrl?e.jsx("div",{className:"text-[rgba(242,200,121,0.7)] text-sm",children:r("gm_players_qr_generating",s)}):e.jsx("img",{src:u.dataUrl,alt:`QR code for ${u.playerName}`,className:"mx-auto h-56 w-56 rounded bg-[rgba(242,200,121,0.08)] p-2 border border-[rgba(242,200,121,0.25)]"}),e.jsx("button",{type:"button",className:"mt-4 text-sm font-semibold text-[var(--color-brass)] underline",onClick:()=>N(u.url,u.playerName),children:r("gm_players_copy_link_instead",s)})]})}),o),o&&x&&ve.createPortal(e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"relative max-w-lg w-full rounded-2xl border border-[rgba(242,200,121,0.25)] bg-[rgba(12,10,16,0.95)] p-6 text-left shadow-[0_25px_55px_rgba(0,0,0,0.7)]",children:[e.jsx("button",{type:"button","aria-label":r("gm_players_modal_close_manual_aria",s),className:"absolute right-3 top-3 rounded-full p-1 text-slate-400 transition hover:text-white",onClick:h,children:"âœ–"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-[var(--color-brass)]",children:r("gm_players_manual_copy_title",s)}),e.jsx("p",{className:"text-sm text-[rgba(242,200,121,0.75)] mb-4",children:x.reason??r("gm_players_manual_copy_fallback",s,{name:x.playerName})}),e.jsx("label",{className:"text-xs uppercase tracking-[0.4em] text-[rgba(242,200,121,0.6)] mb-1 block",children:r("gm_players_manual_copy_label",s)}),e.jsx("textarea",{readOnly:!0,value:x.url,className:"w-full rounded-xl border border-[rgba(242,200,121,0.25)] bg-[rgba(15,12,20,0.85)] p-3 text-sm text-white focus:outline-none",rows:3}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-4",children:[e.jsx("button",{type:"button",onClick:v,className:"flex-1 rounded mafia-button mafia-button--ember px-4 py-2 text-sm font-semibold",children:r("gm_players_manual_copy_copy",s)}),e.jsx("button",{type:"button",onClick:h,className:"flex-1 rounded border border-[rgba(242,200,121,0.25)] px-4 py-2 text-sm font-semibold text-[var(--color-brass)] hover:bg-[rgba(242,200,121,0.08)]",children:r("gm_players_manual_copy_close",s)})]})]})}),o)]})},Ct=/\{\{card:([A-Za-z0-9]+)(?:\|([^}]+))?\}\}/g,It=(t,s,c)=>{const a=[],o=new RegExp(Ct);let j=0,u=0,i=0;const x=p=>{p&&a.push(e.jsx(J.Fragment,{children:p},`${s}-text-${i++}`))};let I;for(;(I=o.exec(t))!==null;){const[p,A,R]=I;x(t.slice(j,I.index));const E=A,M=(R??"").trim()||c[E];c[E]?a.push(e.jsx(Z,{cardId:E,label:M,size:"xs",variant:"inline",className:"mx-0.5 align-baseline"},`${s}-card-${u++}`)):x(p),j=o.lastIndex}return x(t.slice(j)),a.length===0?t:a.length===1?a[0]:a},At=(t,s,c)=>{if(t.kind==="paragraph")return e.jsx("p",{className:"text-slate-100/90 leading-relaxed",children:c(t.text,`${s}-paragraph`)},s);if(t.kind==="list"){const a=t.ordered?"ol":"ul",o=t.ordered?"list-decimal list-inside space-y-1 text-slate-100/90":"list-disc list-inside space-y-1 text-slate-100/90";return e.jsxs("div",{className:"space-y-2",children:[t.title&&e.jsx("p",{className:"text-[var(--color-brass)] text-sm font-semibold tracking-[0.2em] uppercase",children:c(t.title,`${s}-title`)}),e.jsx(a,{className:o,children:t.items.map((j,u)=>e.jsx("li",{children:c(j,`${s}-item-${u}`)},`${s}-item-${u}`))})]},s)}return null},Ge=({section:t,level:s=1,renderBlockFn:c,renderText:a})=>{const o=s===1?"h3":s===2?"h4":"h5",j=s===1?"bg-[rgba(15,12,20,0.9)] border-[rgba(242,200,121,0.25)]":s===2?"bg-[rgba(12,10,16,0.85)] border-[rgba(242,200,121,0.18)]":"bg-[rgba(10,8,14,0.65)] border-[rgba(242,200,121,0.12)] border-dashed",u=s===1?"text-xl font-semibold text-[var(--color-brass)] tracking-[0.25em] uppercase":s===2?"text-lg font-semibold text-slate-100":"text-sm font-semibold text-slate-200 uppercase tracking-[0.35em]";return e.jsxs("article",{className:`rounded-lg border p-4 sm:p-5 space-y-4 ${j}`,children:[e.jsx(o,{className:u,children:a(t.title,`${t.title}-heading`)}),e.jsx("div",{className:"space-y-3",children:t.blocks.map((i,x)=>c(i,`${t.title}-block-${x}`))}),t.subsections?.length?e.jsx("div",{className:"space-y-4",children:t.subsections.map((i,x)=>e.jsx(Ge,{section:i,level:s+1,renderBlockFn:c,renderText:a},`${t.title}-sub-${x}`))}):null]})},Bt=({language:t="pl"})=>{const s=Ke[t]??[],c=r("rules_header_title",t),a=r("rules_missing_language",t),o=$.useMemo(()=>{const i={};return Xe.forEach(x=>{const I=V(x,t);i[x]=I}),i},[t]),j=(i,x)=>It(i,x,o),u=(i,x)=>At(i,x,j);return e.jsxs("div",{className:"h-full overflow-y-auto text-white space-y-8 px-3 pt-6 pb-24 sm:px-4 sm:pt-8",children:[e.jsx("header",{children:e.jsx("h2",{className:"text-2xl font-bold mb-2 mafia-title text-[var(--color-brass)]",children:c})}),s.length===0?e.jsx("div",{className:"bg-[rgba(15,12,20,0.82)] border border-[rgba(242,200,121,0.25)] rounded-2xl p-6 text-[rgba(242,200,121,0.8)]",children:a}):e.jsx("section",{className:"space-y-6",children:s.map(i=>e.jsx(Ge,{section:i,renderBlockFn:u,renderText:j},i.title))})]})},Ot=({state:t,selectedRound:s,onSelectRound:c})=>{const a=t.settings.language,o=Math.max(1,t.currentRound||1),j=Math.min(Math.max(1,s),o),u=Array.from({length:o},(l,b)=>b+1),i=r("logs_heading",a),x=r("logs_subheading",a,{round:j}),I=r("logs_round_label",a),p=r("logs_public_report_title",a),A=r("logs_public_report_placeholder",a),R=r("logs_round_title",a),E=r("logs_round_empty",a),M=t.logs.filter(l=>l.round===j),f=t.publicReportsByRound?.[j]??[],n=l=>(l.fragments?.length?l.fragments:[l]).flatMap(y=>Re(y.key,y.params,t.players,a)),m=(l,b)=>l.map((y,N)=>y.kind==="cardLabel"?e.jsx(Z,{cardId:y.cardId,label:y.label,size:"xs",variant:"logSegment",className:"mx-0.5"},`${b}-card-${N}`):e.jsx(J.Fragment,{children:y.text},`${b}-text-${N}`));return e.jsxs("div",{className:"h-full flex flex-col gap-4 overflow-y-auto text-white px-3 pt-6 pb-24 sm:px-4 sm:pt-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mafia-title text-[var(--color-brass)] tracking-[0.3em] uppercase",children:i}),e.jsx("p",{className:"text-xs text-[rgba(242,200,121,0.6)]",children:x})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs uppercase tracking-[0.35em] text-[rgba(242,200,121,0.7)]",children:[I,e.jsx("select",{value:j,onChange:l=>c(Number(l.target.value)),className:"bg-[rgba(15,12,20,0.85)] text-white px-3 py-1 rounded border border-[rgba(242,200,121,0.2)]",children:u.map(l=>e.jsx("option",{value:l,children:l},l))})]})]}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1 min-h-0",children:e.jsxs("div",{className:"h-full flex flex-col rounded-2xl bg-[rgba(14,12,18,0.85)] border border-[rgba(242,200,121,0.18)] shadow-[inset_0_0_30px_rgba(0,0,0,0.45)]",children:[e.jsx("div",{className:"px-4 py-3 border-b border-[rgba(242,200,121,0.15)] text-[0.65rem] font-semibold uppercase tracking-[0.4em] text-[var(--color-brass)]/85",children:p}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 text-sm text-slate-100/90",children:[f.length===0&&e.jsx("div",{className:"text-[rgba(242,200,121,0.55)]",children:A}),f.map((l,b)=>e.jsx("div",{className:"text-slate-50",children:m(n(l),`logs-report-${b}`)},`${l.key}-${b}`))]})]})}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(xt,{logs:M,players:t.players,language:a,title:R,emptyMessage:E,className:"h-full"})})]})]})},Ht=({language:t,className:s,playerCards:c,playerLabels:a,artMode:o,onArtModeChange:j})=>{const[u,i]=$.useState("icon"),x=o??u,I=j??(n=>i(n)),p=$.useMemo(()=>{const n=t==="pl_pn"?"pl":t,m=new Intl.Collator(n,{sensitivity:"base"});return c&&c.length>0?c.map((y,N)=>{const _=[];re(y.cardId)&&_.push("night"),ne(y.cardId)&&_.push("day"),le(y.cardId,y.instance)&&_.push("gas");const k=V(y.cardId,t),w=a?.[N]?.trim(),h=w?.length?w:`${k} ${y.instance}`;return{cardId:y.cardId,instance:y.instance,imageSrc:oe(y.cardId,y.instance),glyph:te(y.cardId),label:h,indicators:_,description:ie(y.cardId,t)}}).sort((y,N)=>m.compare(y.label,N.label)):Object.values(ae).map(b=>{const y=V(b.id,t),N=[];return re(b.id)&&N.push("night"),ne(b.id)&&N.push("day"),Array.from({length:Math.max(1,b.defaultAmount)},(k,w)=>le(b.id,w+1)).some(Boolean)&&N.push("gas"),{cardId:b.id,instance:1,imageSrc:oe(b.id,1),glyph:te(b.id),label:y,indicators:N,description:ie(b.id,t)}}).sort((b,y)=>m.compare(b.label,y.label))},[t,c,a]),A=r("cards_placeholder_description",t),R="h-full overflow-y-auto text-white px-3 pt-5 pb-24 sm:px-4 sm:pt-7",E=s?`${R} ${s}`:R,M="px-4 py-1.5 text-sm font-semibold rounded-xl transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-brass)]",f=[{value:"icon",label:r("cards_toggle_icons",t)},{value:"image",label:r("cards_toggle_images",t)}];return e.jsx("div",{className:E,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("header",{className:"space-y-3",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold mafia-title text-[var(--color-brass)]",children:r("cards_collection_title",t)}),e.jsx("div",{className:"inline-flex items-center gap-1 rounded-2xl border border-[rgba(242,200,121,0.3)] bg-[rgba(16,14,20,0.85)] p-1 self-center sm:self-auto",children:f.map(n=>{const m=x===n.value;return e.jsx("button",{type:"button",onClick:()=>I(n.value),"aria-pressed":m,className:`${M} ${m?"bg-[var(--color-brass)] text-[rgba(20,14,10,0.9)] shadow-[0_10px_25px_rgba(0,0,0,0.35)]":"text-white/70 hover:text-white"}`,children:n.label},n.value)})})]})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4",children:p.map(n=>e.jsx(Le,{label:n.label,glyph:n.glyph,imageSrc:n.imageSrc,artMode:x,indicators:n.indicators,description:n.description??A},`${n.cardId}-${n.instance}`))})]})})};export{Lt as B,Dt as C,Tt as G,Ot as L,Gt as P,Bt as R,Rt as S,xt as a,Pt as b,Ht as c,St as u};
