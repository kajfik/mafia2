import{T as vn,R as En}from"./lang-pl-C2fTcB1W.js";import{T as Nn,R as Tn}from"./lang-cz-CLz4Wpzs.js";import{T as Mn,R as Rn}from"./lang-en-BtrdBcOK.js";import{T as wn,R as xn}from"./lang-ponaszymu-DrdZSv2I.js";import{o as Pn,e as On,a as Ln,b as Dn,n as jn,r as Kn,c as Gn,d as Bn,t as Un,f as Hn,g as Fn,h as Vn,m as Wn,i as zn,j as Yn,k as Jn,l as Xn,p as Qn,q as qn,s as Zn,u as $n,v as er,w as nr,x as rr,y as tr,z as ir,A as ar,B as sr,C as or,D as lr,E as cr,F as ur,G as dr,H as gr,I as fr,J as hr,K as pr,L as _r}from"./vendor-react-Dc2o_H4k.js";const V={en:{label:"English",locale:"en",rules:Rn,dictionary:Mn},pl:{label:"Polski",locale:"pl",rules:En,dictionary:vn},cz:{label:"Čeština",locale:"cs",rules:Tn,dictionary:Nn},pl_pn:{label:"Po naszymu",locale:"pl",rules:xn,dictionary:wn,fallback:"pl"}},Ee=Object.keys(V),Ia=Ee.map(e=>({code:e,label:V[e].label})),ka=Ee.reduce((e,r)=>(e[r]=V[r].rules,e),{});Ee.reduce((e,r)=>(e[r]=V[r].dictionary,e),{});function rn(e,r){const n=new Set;let t=r;for(;t&&!n.has(t);){n.add(t);const i=V[t]?.dictionary;if(i&&i[e]!==void 0)return i[e];t=V[t]?.fallback}}function tn(e,r){return rn(e,r)??e}function j(e,r,n){let t=tn(e,r);return n&&Object.entries(n).forEach(([i,a])=>{t=t.replace(`{${i}}`,String(a))}),t}function Ne(e,r){return j(`role_${e}`,r)}function va(e,r){return rn(`card_description_${e}`,r)}function Ea(e){return V[e]?.locale??"en"}function oe(e,r){r&&(Array.isArray(e.inactiveCards)||(e.inactiveCards=[]),e.inactiveCards.push(r))}function mr(e,r){return e.cards.filter(n=>n.cardId===r).length}function an(e,r){for(let n=e.cards.length-1;n>=0;n--)if(e.cards[n].cardId===r){const[t]=e.cards.splice(n,1);return oe(e,t),!0}return!1}function sn(e,r,n){const t=e.cards.findIndex(a=>a.cardId===r&&a.instance===n);if(t===-1)return!1;const[i]=e.cards.splice(t,1);return oe(e,i),!0}function D(e,r){for(let n=e.cards.length-1;n>=0;n--)if(e.cards[n].cardId===r){const t=e.cards[n].instance,[i]=e.cards.splice(n,1);return oe(e,i),typeof t=="number"?t:null}return null}function Ar(e,r){let n=0;for(let t=e.cards.length-1;t>=0;t--)if(e.cards[t].cardId===r){const[i]=e.cards.splice(t,1);oe(e,i),n++}return n}function yr(e,r){let n=0;return e.forEach(t=>{[...t.cards,...t.inactiveCards||[]].forEach(a=>{a.cardId===r&&a.instance>n&&(n=a.instance)})}),n+1}function z(e,r,n){const t=yr(e,n);return r.cards.push({cardId:n,instance:t}),t}function Ce(e){return[...e.cards,...e.inactiveCards||[]]}function Na(e,r){const n={},t={};return e.forEach(i=>Ce(i).forEach(a=>{t[a.cardId]=(t[a.cardId]||0)+1})),e.forEach(i=>{n[i.id]=i.cards.map(a=>{const s=Ne(a.cardId,r);return t[a.cardId]>1?`${s} ${a.instance}`:s})}),n}function on(e,r,n,t){const i=Ne(n,r);if(e.reduce((o,u)=>o+Ce(u).filter(l=>l.cardId===n).length,0)<=1)return i;let s=t;return s===void 0&&(s=e.flatMap(u=>Ce(u)).find(u=>u.cardId===n)?.instance),s?`${i} ${s}`:i}const Sr=/{([^}]+)}/g;function v(e,r){return{kind:"cardLabel",cardId:e,instance:r}}function ln(e,r,n){if(typeof e=="string"||typeof e=="number")return e;if(!e)return"";switch(e.kind){case"cardLabel":return on(r,n,e.cardId,e.instance);default:return""}}function $(e,r,n){if(!e)return;const t={};return Object.entries(e).forEach(([i,a])=>{t[i]=ln(a,r,n)}),t}function Cr(e,r,n){return typeof e=="string"||typeof e=="number"?e:e&&e.kind==="cardLabel"?{kind:"cardLabel",cardId:e.cardId,instance:e.instance,label:on(r,n,e.cardId,e.instance)}:""}function br(e,r,n,t,i){const a=Ne(e,i);if(!r)return a;const s=r.trim();return s?s.replace(Sr,(o,u)=>{if(!n||!(u in n))return`{${u}}`;const l=ln(n[u],t,i);return l!==void 0?String(l):""}):a}function Ir(e,r){const n="{{card:";if(!e.startsWith(n,r))return null;const t=e.length;let i=r+n.length;for(;i<t;){const l=e[i];if(l==="|"||l==="}"&&e[i+1]==="}")break;i+=1}if(i>=t)return null;const a=e.slice(r+n.length,i).trim();if(!a)return null;if(e[i]==="}"&&e[i+1]==="}")return{endIndex:i+2,cardId:a};if(e[i]!=="|")return null;const s=i+1;let o=s,u=0;for(;o<t;){const l=e[o];if(l==="{")u+=1;else if(l==="}"){if(u>0)u-=1;else if(e[o+1]==="}"){const c=e.slice(s,o);return{endIndex:o+2,cardId:a,rawLabel:c}}}o+=1}return null}function kr(e,r,n,t){const i=[],a=e??"";let s="";const o=()=>{s&&(i.push({kind:"text",text:s}),s="")};let u=0;for(;u<a.length;){if(a.startsWith("{{card:",u)){const l=Ir(a,u);if(l){o(),i.push({kind:"cardLabel",cardId:l.cardId,label:br(l.cardId,l.rawLabel,r,n,t)}),u=l.endIndex;continue}}if(a[u]==="{"){const l=a.indexOf("}",u+1);if(l!==-1){const c=a.slice(u+1,l);if(!r||!(c in r))s+=a.slice(u,l+1);else{const d=Cr(r[c],n,t);o(),typeof d=="object"&&d&&d.kind==="cardLabel"?i.push({kind:"cardLabel",cardId:d.cardId,instance:d.instance,label:d.label}):i.push({kind:"text",text:d!==void 0?String(d):""})}u=l+1;continue}}s+=a[u],u+=1}return o(),i.length===0&&i.push({kind:"text",text:a}),i}function cn(e,r,n,t){const i=tn(e,t);return kr(i,r,n,t)}function vr(e,r,n){return cn(e.key,e.params,r,n)}function Te(e,r,n){return e.map(t=>j(t.key,n,$(t.params,r,n))).join("")}function Ta(e,r,n){return e.translationFragments?.length?Te(e.translationFragments,r,n):e.translationKey?j(e.translationKey,n,$(e.translationParams,r,n)):e.text??""}function Ma(e,r,n){return e.translationFragments?.length?e.translationFragments.flatMap(t=>vr(t,r,n)):e.translationKey?cn(e.translationKey,e.translationParams,r,n):e.text?[{kind:"text",text:e.text}]:[]}function R(e,r,n={},t="ACTION"){const i=$(n,e.players,e.settings.language),a=j(r,e.settings.language,i);e.logs.push({id:Math.random().toString(),timestamp:Date.now(),phase:e.phase,round:e.currentRound,text:a,translationKey:r,translationParams:n,type:t})}function Er(e,r){if(e.phase!=="NIGHT_ACTIVE"&&e.phase!=="NIGHT_ANNOUNCEMENT")return;const n=e.nightCache.leechLinks;n?.length&&n.forEach(t=>{t.targetId===r&&(t.triggered=!0)})}function un(e,r=1){const n=e.nightCache.gravediggerActive;!n?.length||r<=0||n.forEach(({playerId:t})=>{e.nightCache.gravediggerBonus[t]||(e.nightCache.gravediggerBonus[t]=0),e.nightCache.gravediggerBonus[t]+=r})}function Nr(e,r){e.nightCache.glazierPendingRewards||(e.nightCache.glazierPendingRewards=[]),e.players.forEach(n=>{n.status.isAlive&&n.id!==r&&n.cards.some(t=>t.cardId==="Glazier")&&(n.cards.some(t=>t.cardId==="Mirror")||e.nightCache.glazierPendingRewards.includes(n.id)||e.nightCache.glazierPendingRewards.push(n.id))})}function Tr(e,r){const n=e.filter(i=>i.status.isAlive),t=n.findIndex(i=>i.id===r);return t===-1?{left:null,right:null}:{left:n[(t-1+n.length)%n.length],right:n[(t+1)%n.length]}}function Mr(){return`shot-${Date.now()}-${Math.random().toString(36).slice(2,8)}`}function dn(e,r){e.nightCache.doctorProtections||(e.nightCache.doctorProtections=[]);const n=e.nightCache.doctorProtections.findIndex(t=>t.targetId===r);return n>=0?(e.nightCache.doctorProtections.splice(n,1),!0):!1}function Rr(e,r){const n=e.nightCache.executionerPairs;if(!n?.length)return r;const t=n.findIndex(o=>o.savedId===r);if(t===-1)return r;const[i]=n.splice(t,1),a=e.players.find(o=>o.id===i.savedId);a&&(a.status.executionerStatus="NONE");const s=e.players.find(o=>o.id===i.victimId);return s&&(s.status.executionerStatus="NONE",s.status.isAlive)?s.id:r}function W(e,r,n){if(n==="HANG"){const s=Rr(e,r);if(s!==r)return W(e,s,"HANG");r=s}const t=e.players.find(s=>s.id===r);if(!t||!t.status.isAlive)return null;if(n==="HANG"){const s=D(t,"RopeWalker");if(s!==null)return R(e,"log_day_ropewalker_lost",{target:t.name,num:s}),{type:"ROPEWALKER",playerId:t.id,playerName:t.name,instance:s}}const i=D(t,"Immunity");if(i!==null)return R(e,"log_day_immunity_lost",{target:t.name,num:i}),{type:"IMMUNITY",playerId:t.id,playerName:t.name,instance:i};if(n==="SHOOT"){const s=D(t,"KevlarVest");if(s!==null)return R(e,"log_day_vest_hit",{target:t.name,num:s}),{type:"KEVLAR",playerId:t.id,playerName:t.name,instance:s}}const a=D(t,"CloudWalker");return a!==null?(R(e,"log_day_cloudwalker_lost",{target:t.name,num:a}),Y(e,t,{lossType:"CLOUDWALKER"}),{type:"CLOUDWALKER",playerId:t.id,playerName:t.name,instance:a}):(t.status.isAlive=!1,R(e,"log_day_death",{target:t.name},"DEATH"),Y(e,t,{lossType:"DEATH"}),Re(e,"DAY"),{type:"DEATH",playerId:t.id,playerName:t.name})}const Be={public_report_bullet_dead_target:"log_night_bullet_dead_target",public_report_bullet_matrix_catch:"log_night_bullet_matrix_catch",public_report_bullet_magnet:"log_night_bullet_magnet",public_report_bullet_split:"log_night_bullet_split",public_report_bullet_tunnel_single:"log_night_bullet_tunnel_single",public_report_bullet_tunnel_segment:"log_night_bullet_tunnel_segment",public_report_bullet_slime:"log_night_bullet_slime",public_report_bullet_al_capone:"log_night_bullet_al_capone",public_report_bullet_doctor:"log_night_bullet_doctor",public_report_bullet_mirror_break:"log_night_bullet_mirror_break",public_report_bullet_return:"log_night_bullet_return",public_report_bullet_vest_loss:"log_night_bullet_vest_loss",public_report_bullet_cloudwalker_loss:"log_night_bullet_cloudwalker_loss",public_report_bullet_death:"log_night_bullet_death"},Ue={log_night_bullet_tunnel_single:"log_night_bullet_tunnel_initial",log_night_bullet_magnet:"log_night_bullet_magnet_initial",log_night_bullet_mirror_break:"log_night_bullet_mirror_break_initial",log_night_bullet_slime:"log_night_bullet_slime_initial",log_night_bullet_al_capone:"log_night_bullet_al_capone_initial",log_night_bullet_doctor:"log_night_bullet_doctor_initial",log_night_bullet_vest_loss:"log_night_bullet_vest_loss_initial",log_night_bullet_cloudwalker_loss:"log_night_bullet_cloudwalker_loss_initial",log_night_bullet_death:"log_night_bullet_death_initial"};function Me(e,r,n,t=null,i){const a=Mr(),s=e.players.find(g=>g.id===r)?.name||"?",o={key:"public_report_bullet_start"},u=i?{key:"log_night_bullet_start",params:{cardLabel:i.shooterLabel,shooter:i.shooterName,target:i.initialTargetName}}:{key:"log_night_bullet_start_generic",params:{target:s}},l=[{targetId:r,previousTargetId:t,visitedTunnels:new Set,magnetAttractors:new Set,isRedirected:!1,fragments:[o],logFragments:[u],segments:[],shotId:a,sourceId:t}];let c=0;const d=50;for(;l.length&&c<d;){const g=l.shift();c++,wr(e,l,g.targetId,g.previousTargetId,n,g.visitedTunnels,g.magnetAttractors,g.isRedirected,g.fragments,g.logFragments,g.segments,g.shotId,g.sourceId)}Ur(e,a)}function wr(e,r,n,t,i,a,s,o,u,l,c,d,g){let E=t,N=n,K=0,T=new Set(a);const G=new Set(s);let B=o,y=u,p=l,b=c;const Le=i==="MAFIA",ce=i==="SNIPER",ne=i==="MATRIX",An=Le||i==="MAD_GUNMAN"||ce,I=M=>{y.push(M);const f=Be[M.key]??M.key,re=p.length===1?Ue[f]??f:f;p.push({key:re,params:M.params?{...M.params}:void 0})},ue=M=>{p.push(M)};for(;K<25;){K++;const M=E;Kr(b,M,N);const f=e.players.find(S=>S.id===N),k=f?.name||"?";if(!f||!f.status.isAlive){I({key:"public_report_bullet_dead_target",params:{target:k}}),x(e,y,p,b,d,g);return}const re=e.nightCache.matrixTrap;if(re&&re.playerId===f.id&&f.cards.some(S=>S.cardId==="Matrix")){e.nightCache.matrixStoredBullets++,e.nightCache.reportData.matrixBulletsCaught++,I({key:"public_report_bullet_matrix_catch",params:{target:k}}),x(e,y,p,b,d,g);return}if(!ne){const S=Tr(e.players,N),te=C=>!C||!C.status.isAlive||!C.status.isMagnetized||G.has(C.id)?!1:(I({key:"public_report_bullet_magnet",params:{target:C.name}}),G.add(C.id),E=f.id,N=C.id,B=!0,!0);if(te(S.left)||te(S.right))continue;const U=e.globalTunnels.filter(C=>C.sourceId===f.id&&!T.has(C.id)).sort((C,w)=>C.createdAt-w.createdAt);if(U.length){U.length>1&&I({key:"public_report_bullet_split",params:{count:U.length}});const C=F(y),w=F(p),ge=be(b),fe=new Set(G),yn=new Set(T);U.forEach((H,O)=>{const Sn=e.players.find(kn=>kn.id===H.targetId),he=O===0?T:new Set(yn);he.add(H.id);const pe=O===0?y:F(C),ie=O===0?p:F(w),Ke=O===0?b:be(ge),Cn=O===0?G:new Set(fe),Ge=e.globalTunnels.indexOf(H),bn=typeof H.tunnelNumber=="number"?H.tunnelNumber:Ge>=0?Ge+1:O+1,_e=U.length>1?"public_report_bullet_tunnel_segment":"public_report_bullet_tunnel_single",me={num:bn,src:k,target:Sn?.name||"?"};U.length>1&&(me.index=O+1),pe.push({key:_e,params:me});const Ae=Be[_e]??_e,In=ie.length===1?Ue[Ae]??Ae:Ae;ie.push({key:In,params:me}),O===0?(T=he,N=H.targetId,E=f.id,B=!0,y=pe,p=ie,b=Ke):r.push({targetId:H.targetId,previousTargetId:f.id,visitedTunnels:he,magnetAttractors:Cn,isRedirected:!0,fragments:pe,logFragments:ie,segments:Ke,shotId:d,sourceId:g})});continue}}const De=mr(f,"Mirror");if(De>0){const S=f.status.mudCount>0;S&&(f.status.mudCount=Math.max(0,f.status.mudCount-1));const te=D(f,"Mirror");if(Nr(e,f.id),I({key:"public_report_bullet_mirror_break",params:{target:k,num:te??De}}),!ce&&!ne&&!S){const w=M,ge=w?e.players.find(fe=>fe.id===w)?.name||"?":k;if(I({key:"public_report_bullet_return",params:{target:ge}}),!w||w===f.id){x(e,y,p,b,d,g);return}N=w,E=f.id,B=!0;continue}I({key:"public_report_bullet_continue"}),p.length&&p.pop(),ue({key:S?"log_night_bullet_continue_mud":ce?"log_night_bullet_continue_sniper":"log_night_bullet_continue_matrix",params:{target:k}})}if(!ne&&An&&f.status.isSlimed&&!f.status.isSanded&&!e.nightCache.slimeUsedOnPlayers.includes(f.id)){e.nightCache.slimeUsedOnPlayers.push(f.id),f.status.isSlimed=!1,I({key:"public_report_bullet_slime",params:{target:k}}),x(e,y,p,b,d,g);return}if(Le&&!B&&f.cards.some(S=>S.cardId==="AlCapone")){I({key:"public_report_bullet_al_capone",params:{target:k}}),x(e,y,p,b,d,g);return}if(!ne&&dn(e,f.id)){I({key:"public_report_bullet_doctor",params:{target:k}}),x(e,y,p,b,d,g);return}const je=D(f,"KevlarVest");if(je!==null){I({key:"public_report_bullet_vest_loss",params:{target:k,num:je}}),x(e,y,p,b,d,g);return}const de=D(f,"CloudWalker");if(de!==null){un(e),I({key:"public_report_bullet_cloudwalker_loss",params:{target:k,num:de}}),Y(e,f,{lossType:"CLOUDWALKER",lostInstance:de,logAppender:S=>ue(S)}),x(e,y,p,b,d,g);return}f.status.isAlive=!1,Y(e,f,{lossType:"DEATH",logAppender:S=>ue(S)}),I({key:"public_report_bullet_death",params:{name:k}}),Re(e,"NIGHT"),x(e,y,p,b,d,g);return}}function xr(e){return e.cards.some(r=>r.cardId==="Mafia")}function Pr(e){const r=e.players.filter(t=>t.status.isAlive);if(!r.length)return null;const n=r.filter(xr).length;return n===0?"INNOCENT":n===r.length?"MAFIA":null}function Re(e,r){if(e.victory)return e.victory.side;const n=Pr(e);if(!n)return null;const t=n==="MAFIA"?"victory_mafia":"victory_innocent";return e.victory={side:n,cause:r,announced:!1},r==="NIGHT"?e.nightCache.reportData.victoryKey=t:e.uiState.pendingVictoryKey=t,n}function He(e,r){let n=null;return e.forEach(t=>{t.status.isAlive&&t.cards.forEach(i=>{i.cardId===r&&(!n||i.instance>n.instance)&&(n={player:t,instance:i.instance})})}),n}function Fe(e,r,n){[...r].sort((i,a)=>i.instance-a.instance).forEach(i=>{const a=e.players.find(l=>l.id===i.shooterId);if(!a||a.status.isJailed)return;const s=e.players.find(l=>l.id===i.targetId)?.name||"Unknown",u=v(n==="SNIPER"?"Sniper":"MadGunman",i.instance);Me(e,i.targetId,n,a.id,{shooterLabel:u,shooterName:a.name,initialTargetName:s})})}function Or(e){const r=e.nightCache.pendingShots;if(r.mafiaVotes?.length){const n=e.players.filter(u=>u.status.isAlive&&u.cards.some(l=>l.cardId==="Mafia")),t=n.map(u=>u.id),i=r.mafiaVotes.filter(u=>t.includes(u.shooterId)),a=t.every(u=>i.some(l=>l.shooterId===u)),s=new Set(i.map(u=>u.targetId)),o=n.length>0&&a&&s.size===1?i[0]?.targetId??null:null;if(o){const u=He(e.players,"Mafia");if(u){const{player:l,instance:c}=u;if(l.status.isJailed)R(e,"log_mafia_jailed",{cardLabel:v("Mafia",c),player:l.name});else{const d=e.players.find(E=>E.id===o)?.name||"Unknown",g=v("Mafia",c);Me(e,o,"MAFIA",l.id,{shooterLabel:g,shooterName:l.name,initialTargetName:d})}}}else if(n.length>0){const u=n.filter(l=>l.status.isJailed);if(u.length>0){const l=He(u,"Mafia");if(l){const{player:c,instance:d}=l;R(e,"log_mafia_jailed",{cardLabel:v("Mafia",d),player:c.name})}}else R(e,"log_mafia_no_consensus")}r.mafiaVotes=[]}r.madGunman.length>0&&(Fe(e,r.madGunman,"MAD_GUNMAN"),r.madGunman=[]),r.sniper.length>0&&(Fe(e,r.sniper,"SNIPER"),r.sniper=[])}function Ve(e,r){if(!r||!r.status.isAlive)return{outcome:"ALREADY_DEAD"};if(r.hasGasMask)return{outcome:"GAS_MASK"};if(dn(e,r.id))return{outcome:"DOCTOR"};const n=D(r,"CloudWalker");return n!==null?(un(e),Y(e,r,{lossType:"CLOUDWALKER"}),{outcome:"CLOUDWALKER",cloudwalkerInstance:n}):(Ar(r,"CloudWalker"),r.status.isAlive=!1,Y(e,r,{lossType:"DEATH"}),Re(e,"NIGHT"),{outcome:"DEATH"})}function Lr(e){if(!e.nightCache.pendingToxicSocks.length)return;const r=e.nightCache.reportData;e.nightCache.pendingToxicSocks.forEach(n=>{const t=e.players.find(l=>l.id===n.sockId);if(!t||!t.status.isAlive)return;r.sock.usedBy=n.sockId;const i=e.players.find(l=>l.id===n.firstTargetId)||null,a=e.players.find(l=>l.id===n.secondTargetId)||null,s=Ve(e,i),o=Ve(e,a);r.sock.first={targetId:i?.id,result:s.outcome,cloudwalkerInstance:s.cloudwalkerInstance??void 0},r.sock.second={targetId:a?.id,result:o.outcome,cloudwalkerInstance:o.cloudwalkerInstance??void 0};const u=jr(t,i,a,s,o);if(u.length){const l=Te(u,e.players,e.settings.language),c=s.outcome==="DEATH"||o.outcome==="DEATH"?"DEATH":"ACTION";e.logs.push({id:Math.random().toString(),timestamp:Date.now(),phase:e.phase,round:e.currentRound,text:l,translationFragments:u,type:c})}}),e.nightCache.pendingToxicSocks=[]}const Dr={GAS_MASK:"log_sock_result_gasmask",ALREADY_DEAD:"log_sock_result_dead",DOCTOR:"log_sock_result_doctor",CLOUDWALKER:"log_sock_result_cloudwalker",DEATH:"log_sock_result_death"};function jr(e,r,n,t,i){const a=[],s=e.cards.find(l=>l.cardId==="Sock")?.instance;a.push({key:"log_sock_throw_intro",params:{cardLabel:v("Sock",s),player:e.name,first:r?.name||"?",second:n?.name||"?"}});const o=We(t,r);o&&a.push(o);const u=We(i,n);return u&&a.push(u),a}function We(e,r){const n=Dr[e.outcome];if(!n)return null;const t={name:r?.name||"?"};return e.outcome==="CLOUDWALKER"&&(t.num=e.cloudwalkerInstance??"?"),{key:n,params:t}}function Y(e,r,n={}){const{lossType:t="DEATH",logAppender:i,lostInstance:a}=n;Er(e,r.id);const s=t==="CLOUDWALKER";if(s&&r.cards.some(o=>o.cardId==="Gandalf")&&!e.nightCache.kuskonaTriggered){const o=e.players.find(u=>u.cards.some(l=>l.cardId==="HorsePiece"));if(o&&o.status.isAlive){const u=z(e.players,o,"CloudWalker"),l=o.cards.find(c=>c.cardId==="HorsePiece")?.instance;e.nightCache.reportData.cloudwalkers.horsepiece.push({num:u,cardInstance:l}),i||R(e,"log_night_cloudwalker_gain",{cardLabel:v("HorsePiece",l),player:o.name,num:u}),i&&i({key:"log_night_bullet_horsepiece_from_gandalf",params:{horse:o.name,num:u,gandalf:r.name,lost:a??"?"}}),e.nightCache.kuskonaTriggered=!0}}if(s&&r.cards.some(o=>o.cardId==="HorsePiece")&&!e.nightCache.gandalfTriggered){const o=e.players.find(u=>u.cards.some(l=>l.cardId==="Gandalf"));if(o&&o.status.isAlive){const u=z(e.players,o,"CloudWalker"),l=o.cards.find(c=>c.cardId==="Gandalf")?.instance;e.nightCache.reportData.cloudwalkers.gandalf.push({num:u,cardInstance:l}),i||R(e,"log_night_cloudwalker_gain",{cardLabel:v("Gandalf",l),player:o.name,num:u}),i&&i({key:"log_night_bullet_gandalf_from_horse",params:{gandalf:o.name,num:u,horse:r.name,lost:a??"?"}}),e.nightCache.gandalfTriggered=!0}}}function F(e){return e.map(r=>{if(!r.params)return{...r};const n={};return Object.entries(r.params).forEach(([t,i])=>{i&&typeof i=="object"&&!Array.isArray(i)?n[t]={...i}:Array.isArray(i)?n[t]=[...i]:n[t]=i}),{...r,params:n}})}function be(e){return e.map(r=>({fromId:r.fromId,toId:r.toId}))}function Kr(e,r,n){n&&(r&&r===n||e.push({fromId:r??null,toId:n}))}function Ie(e,r){if(e===r)return!0;if(typeof e!=typeof r||e===null||r===null)return!1;if(Array.isArray(e)&&Array.isArray(r))return e.length!==r.length?!1:e.every((n,t)=>Ie(n,r[t]));if(typeof e=="object"&&typeof r=="object"){const n=e,t=r,i=Object.keys(n),a=Object.keys(t);return i.length!==a.length?!1:i.every(s=>Ie(n[s],t[s]))}return!1}function Gr(e,r){if(e.key!==r.key)return!1;const n=e.params??{},t=r.params??{},i=Object.keys(n),a=Object.keys(t);return i.length!==a.length?!1:i.every(s=>Ie(n[s],t[s]))}function ze(e,r){let n=0;for(;n<e.length&&n<r.length&&Gr(e[n],r[n]);)n++;return n>=r.length?e:[...e,...r.slice(n)]}function Br(e,r){return Te(r,e.players,e.settings.language)}function x(e,r,n,t,i,a){if(!r.length)return;const s=F(r),o=F(n),u=e.nightCache.bulletReportLookup??(e.nightCache.bulletReportLookup={}),l=u[i];if(l)l.publicEntry.fragments=ze(l.publicEntry.fragments??[],s),l.logFragments=ze(l.logFragments,o);else{const d={key:"public_report_bullet_compound",fragments:s};e.nightCache.reportData.bullets.push(d),u[i]={publicEntry:d,logFragments:o}}if(!t.length)return;const c=be(t);e.nightCache.bulletAnimations||(e.nightCache.bulletAnimations=[]),e.nightCache.bulletAnimations.push({id:`bullet-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,shotId:i,sourceId:a,segments:c})}function Ur(e,r){e.nightCache.bulletReportLookup||(e.nightCache.bulletReportLookup={});const n=e.nightCache.bulletReportLookup[r];if(!n||!n.logFragments.length){delete e.nightCache.bulletReportLookup[r];return}const t=F(n.logFragments),i=Br(e,t),a=n.logFragments.some(s=>s.key==="public_report_bullet_death");e.logs.push({id:Math.random().toString(),timestamp:Date.now(),phase:e.phase,round:e.currentRound,text:i,translationFragments:t,type:a?"DEATH":"ACTION"}),delete e.nightCache.bulletReportLookup[r]}const Hr={CloudWalker:{id:"CloudWalker",defaultAmount:7,nightOrder:-1},Immunity:{id:"Immunity",defaultAmount:2,nightOrder:-1},RopeWalker:{id:"RopeWalker",defaultAmount:3,nightOrder:-1},KevlarVest:{id:"KevlarVest",defaultAmount:2,nightOrder:-1},Matrix:{id:"Matrix",defaultAmount:1,nightOrder:2},Jailer:{id:"Jailer",defaultAmount:1,nightOrder:0},Gravedigger:{id:"Gravedigger",defaultAmount:1,nightOrder:1},Mage:{id:"Mage",defaultAmount:3,nightOrder:3},Slime:{id:"Slime",defaultAmount:2,nightOrder:6},Leech:{id:"Leech",defaultAmount:1,nightOrder:8},Sand:{id:"Sand",defaultAmount:1,nightOrder:9},Cobra:{id:"Cobra",defaultAmount:1,nightOrder:10},Magnet:{id:"Magnet",defaultAmount:1,nightOrder:11},GhostBobo:{id:"GhostBobo",defaultAmount:1,nightOrder:12},Doctor:{id:"Doctor",defaultAmount:1,nightOrder:13},SwampMonster:{id:"SwampMonster",defaultAmount:1,nightOrder:14},Mafia:{id:"Mafia",defaultAmount:3,nightOrder:15},MadGunman:{id:"MadGunman",defaultAmount:2,nightOrder:18},Sniper:{id:"Sniper",defaultAmount:1,nightOrder:20},Sock:{id:"Sock",defaultAmount:1,nightOrder:21},Judge:{id:"Judge",defaultAmount:1,nightOrder:22},BlindExecutioner:{id:"BlindExecutioner",defaultAmount:1,nightOrder:23},Spyglass:{id:"Spyglass",defaultAmount:1,nightOrder:24},Mirror:{id:"Mirror",defaultAmount:5,nightOrder:-1},Terrorist:{id:"Terrorist",defaultAmount:1,nightOrder:-1},Astronomer:{id:"Astronomer",defaultAmount:1,nightOrder:-1},Meciar:{id:"Meciar",defaultAmount:1,nightOrder:-1},Kovac:{id:"Kovac",defaultAmount:1,nightOrder:-1},AlCapone:{id:"AlCapone",defaultAmount:1,nightOrder:-1},Gandalf:{id:"Gandalf",defaultAmount:1,nightOrder:-1},HorsePiece:{id:"HorsePiece",defaultAmount:1,nightOrder:-1},Atheist:{id:"Atheist",defaultAmount:1,nightOrder:-1},Anarchist:{id:"Anarchist",defaultAmount:1,nightOrder:-1},Glazier:{id:"Glazier",defaultAmount:1,nightOrder:-1},MassMurderer:{id:"MassMurderer",defaultAmount:1,nightOrder:-1},Communist:{id:"Communist",defaultAmount:1,nightOrder:-1},TimeLord:{id:"TimeLord",defaultAmount:1,nightOrder:-1}},Fr=new Set(["CloudWalker","KevlarVest","Mafia","Jailer","Sock","Mage","Matrix","Cobra","Gravedigger","Spyglass","TimeLord","Slime","Sniper","Mirror","MadGunman","SwampMonster","Atheist","Sand","GhostBobo","Leech","Glazier","Magnet","Judge","AlCapone","Doctor","HorsePiece","Gandalf"]),Vr=new Set(["CloudWalker","KevlarVest","BlindExecutioner","TimeLord","Astronomer","RopeWalker","Communist","Immunity","MassMurderer","HorsePiece","Gandalf","Anarchist","Meciar","Kovac","Terrorist"]);function Ra(e){return Fr.has(e)}function wa(e){return Vr.has(e)}function we(e,r){return e==="Mage"&&r===2||e==="MadGunman"&&r===2||e==="GhostBobo"}function Wr(e){let r=e.length,n;for(;r!==0;)n=Math.floor(Math.random()*r),r--,[e[r],e[n]]=[e[n],e[r]];return e}const zr=new Set(["Gravedigger","Leech","AlCapone","Gandalf","HorsePiece"]),Yr=1e4;function Jr(e,r,n){if(e!=="Mafia"||n<=0)return r;const t=Math.round(n/3);return Math.max(1,t)}function Xr(e,r){if(!e.length)return[];const n=e.length,t=[];if(r){const o={};r.forEach(u=>{const l=(o[u]||0)+1;o[u]=l,t.push({cardId:u,instance:l})})}else Object.values(Hr).forEach(o=>{const u=Jr(o.id,o.defaultAmount,n);for(let l=1;l<=u;l++)t.push({cardId:o.id,instance:l})});let i=Math.floor(t.length/e.length);const a=i;for(;i>=0;){const o=Qr(t,e,i);if(o)return Ye(o),i<a&&console.warn(`Reduced cards per player from ${a} to ${i} to satisfy manipulation rules.`),o;i--}const s=e.map(o=>xe(o));return Ye(s),s}function Qr(e,r,n){const t=n*r.length;if(t===0)return r.map(i=>xe(i));for(let i=0;i<Yr;i++){const a=Wr([...e]).slice(0,t),s=qr(a,r,n);if(s)return s}return null}function qr(e,r,n){const t=r.map(i=>({player:xe(i),stats:Zr(),slotsRemaining:n}));for(const i of e){const a=[];let s=0;if(t.forEach((l,c)=>{l.slotsRemaining<=0||$r(l.stats,i)&&(l.slotsRemaining>s&&(s=l.slotsRemaining,a.length=0),l.slotsRemaining===s&&a.push(c))}),!a.length)return null;const o=a[Math.floor(Math.random()*a.length)],u=t[o];u.player.cards.push({cardId:i.cardId,instance:i.instance}),et(u.stats,i),u.slotsRemaining--}return t.map(i=>i.player)}function xe(e){return{...e,cards:[],inactiveCards:[],hasGasMask:!1,status:{...e.status,mudCount:0,swampChargesLeft:0}}}function Zr(){return{mafia:0,madGunman:0,slime:0,rope:0,cloudwalker:0,limitLivesToOne:!1,gasMaskSources:0,hasDoctor:!1,hasSpyglass:!1,hasAtheist:!1,hasMatrix:!1,hasLeech:!1,hasCobra:!1,hasGandalf:!1,hasHorsePiece:!1,hasGravedigger:!1,hasAlCapone:!1}}function $r(e,r){if(we(r.cardId,r.instance)&&e.gasMaskSources>=1)return!1;switch(r.cardId){case"Mafia":return e.mafia===0&&!e.hasDoctor&&!e.hasSpyglass;case"Doctor":return!e.hasDoctor&&e.mafia===0;case"Spyglass":return!e.hasSpyglass&&e.mafia===0;case"MadGunman":return e.madGunman===0;case"Slime":return e.slime===0;case"RopeWalker":return e.rope<2;case"CloudWalker":return!(e.cloudwalker>=2||e.limitLivesToOne&&e.cloudwalker>=1);case"Atheist":return!e.hasAtheist&&!e.hasMatrix;case"Matrix":return!e.hasMatrix&&!e.hasAtheist;case"Leech":return e.hasLeech||e.hasCobra?!1:e.cloudwalker<=1;case"Cobra":return!e.hasCobra&&!e.hasLeech;case"Gandalf":return e.hasGandalf||e.hasHorsePiece?!1:e.cloudwalker<=1;case"HorsePiece":return e.hasHorsePiece||e.hasGandalf?!1:e.cloudwalker<=1;case"Gravedigger":return e.hasGravedigger?!1:e.cloudwalker<=1;case"AlCapone":return e.hasAlCapone?!1:e.cloudwalker<=1;default:return!0}}function et(e,r){switch(we(r.cardId,r.instance)&&e.gasMaskSources++,r.cardId){case"CloudWalker":e.cloudwalker++;break;case"RopeWalker":e.rope++;break;case"Mafia":e.mafia++;break;case"MadGunman":e.madGunman++;break;case"Slime":e.slime++;break;case"Doctor":e.hasDoctor=!0;break;case"Spyglass":e.hasSpyglass=!0;break;case"Atheist":e.hasAtheist=!0;break;case"Matrix":e.hasMatrix=!0;break;case"Leech":e.hasLeech=!0;break;case"Cobra":e.hasCobra=!0;break;case"Gandalf":e.hasGandalf=!0;break;case"HorsePiece":e.hasHorsePiece=!0;break;case"Gravedigger":e.hasGravedigger=!0;break;case"AlCapone":e.hasAlCapone=!0;break}zr.has(r.cardId)&&(e.limitLivesToOne=!0)}function Ye(e){e.forEach(r=>{if(r.hasGasMask=r.cards.some(n=>we(n.cardId,n.instance)),r.cards.some(n=>n.cardId==="SwampMonster")){const n=r.cards.some(t=>["Mafia","MadGunman","Sniper"].includes(t.cardId));r.status.swampChargesLeft=n?2:3}else r.status.swampChargesLeft=0})}const nt=[{cardId:"Jailer"},{cardId:"Gravedigger"},{cardId:"Matrix"},{cardId:"Mage"},{cardId:"Slime"},{cardId:"Leech"},{cardId:"Sand"},{cardId:"Cobra"},{cardId:"Magnet"},{cardId:"GhostBobo"},{cardId:"Doctor"},{cardId:"SwampMonster"},{cardId:"Mafia"},{cardId:"MadGunman"},{cardId:"Sniper"},{cardId:"Sock"},{cardId:"Judge"},{cardId:"BlindExecutioner"},{cardId:"Matrix",mode:"MATRIX_SHOT"}],rt=[{cardId:"Gravedigger"},{cardId:"Matrix"},{cardId:"Mage"},{cardId:"Slime"},{cardId:"Leech"},{cardId:"Sand"},{cardId:"Doctor"},{cardId:"SwampMonster"},{cardId:"Mafia"},{cardId:"Sniper"},{cardId:"Sock"},{cardId:"BlindExecutioner"},{cardId:"Matrix",mode:"MATRIX_SHOT"}];function tt(e){return e<2?!1:(e-2)%3===0}function Je(e,r,n){return e.players.filter(i=>i.status.isAlive).flatMap(i=>i.cards.filter(a=>a.cardId===r).map(a=>({cardId:r,instance:a.instance,mode:n}))).sort((i,a)=>i.instance-a.instance)}function it(e){return e.players.filter(n=>n.status.isAlive&&!n.status.gravediggerUsed).flatMap(n=>n.cards.filter(t=>t.cardId==="Gravedigger").map(t=>({cardId:"Gravedigger",instance:t.instance}))).sort((n,t)=>n.instance-t.instance)}function at(e){return e.players.filter(n=>n.status.isAlive&&!n.status.matrixAbilityUsed).flatMap(n=>n.cards.filter(t=>t.cardId==="Matrix").map(t=>({cardId:"Matrix",instance:t.instance}))).sort((n,t)=>n.instance-t.instance)}function st(e){if(e.nightCache.matrixStoredBullets<=0)return[];const r=e.nightCache.matrixTrap;if(!r)return[];const n=e.players.find(a=>a.id===r.playerId&&a.status.isAlive);return n?n.cards.some(a=>a.cardId==="Matrix"&&a.instance===r.instance)?[{cardId:"Matrix",instance:r.instance,mode:"MATRIX_SHOT"}]:[]:[]}function ot(e){const r=e.currentRound%2===0?nt:rt,n=[];return r.forEach(t=>{if(t.cardId==="Matrix"&&t.mode!=="MATRIX_SHOT"){n.push(...at(e));return}if(t.mode==="MATRIX_SHOT"){n.push(...st(e));return}if(t.cardId==="Gravedigger"){n.push(...it(e));return}n.push(...Je(e,t.cardId,t.mode))}),tt(e.currentRound)&&n.push(...Je(e,"Spyglass")),n}function gn(){return{ghostTargets:[],judgeTargets:[],slimedTargets:[],sandedTargets:[],sandProtectedTargets:[],matrixBulletsCaught:0,sock:{usedBy:null},cloudwalkers:{leech:[],cobra:[],gravedigger:[],glazier:[],gandalf:[],horsepiece:[]},bullets:[],victoryKey:null}}const lt={GAS_MASK:"public_report_sock_first_gasmask",ALREADY_DEAD:"public_report_sock_first_dead",DOCTOR:"public_report_sock_first_doctor",CLOUDWALKER:"public_report_sock_first_cloudwalker",DEATH:"public_report_sock_first_death"},ct={GAS_MASK:"public_report_sock_second_gasmask",ALREADY_DEAD:"public_report_sock_second_dead",DOCTOR:"public_report_sock_second_doctor",CLOUDWALKER:"public_report_sock_second_cloudwalker",DEATH:"public_report_sock_second_death"};function ut(e){const r=[];e.nightCache.reportData||(e.nightCache.reportData=gn());const n=e.nightCache.reportData,t=l=>l?e.players.find(c=>c.id===l)?.name:void 0,i=l=>Array.from(new Set(l)),a=l=>Array.from(new Set(l)),s=l=>{const c=new Set;return l.filter(d=>c.has(d.num)?!1:(c.add(d.num),!0))},o=l=>l.reduce((c,d)=>(c[d]=(c[d]??0)+1,c),{});r.push({key:"public_report_default"}),i(n.ghostTargets).forEach(l=>{const c=t(l);c&&r.push({key:"public_report_ghost_bobo",params:{name:c}})}),i(n.judgeTargets).forEach(l=>{const c=t(l);c&&r.push({key:"public_report_judge",params:{name:c}})});const u=o(n.slimedTargets);if(Object.entries(u).forEach(([l,c])=>{const d=t(l);d&&(c===1?r.push({key:"public_report_slime",params:{name:d}}):r.push({key:"public_report_slime_multi",params:{name:d,count:c}}))}),i(n.sandedTargets).forEach(l=>{const c=t(l);c&&r.push({key:"public_report_sand",params:{name:c}})}),n.sandProtectedTargets.length&&n.sandProtectedTargets.forEach(()=>r.push({key:"public_report_sand_saved"})),n.matrixBulletsCaught>0&&r.push({key:"public_report_matrix",params:{count:n.matrixBulletsCaught}}),n.bullets.length&&r.push(...dt(n.bullets)),n.sock.usedBy){const l=[{key:"public_report_sock_used"}],c=Xe("first",n.sock.first,t),d=Xe("second",n.sock.second,t);c&&(l.push(c),d?l.push(d):l.push({key:"public_report_sock_first_only_suffix"})),r.push({key:"public_report_sock_used",fragments:l})}return a(n.cloudwalkers.leech).forEach(l=>{r.push({key:"public_report_leech_cloudwalker",params:{num:l}})}),a(n.cloudwalkers.cobra).forEach(l=>{r.push({key:"public_report_cobra_cloudwalker",params:{num:l}})}),s(n.cloudwalkers.gravedigger).forEach(({num:l,cardInstance:c})=>{r.push({key:"public_report_cloudwalker_gain",params:{num:l,cardLabel:v("Gravedigger",c)}})}),a(n.cloudwalkers.glazier).forEach(l=>{r.push({key:"public_report_glazier_mirror",params:{num:l}})}),s(n.cloudwalkers.gandalf).forEach(({num:l,cardInstance:c})=>{r.push({key:"public_report_cloudwalker_gain",params:{num:l,cardLabel:v("Gandalf",c)}})}),s(n.cloudwalkers.horsepiece).forEach(({num:l,cardInstance:c})=>{r.push({key:"public_report_cloudwalker_gain",params:{num:l,cardLabel:v("HorsePiece",c)}})}),n.victoryKey&&r.push({key:n.victoryKey}),r}function Xe(e,r,n){if(!r)return null;const i=(e==="first"?lt:ct)[r.result];if(!i)return null;if(!(r.result==="DEATH"||r.result==="CLOUDWALKER"))return{key:i};const o={name:n(r.targetId)||"?"};return r.result==="CLOUDWALKER"&&(o.num=r.cloudwalkerInstance??"?"),{key:i,params:o}}function dt(e){const r=[...e];for(let n=r.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[r[n],r[t]]=[r[t],r[n]]}return r}function gt(){return{selfHealOffset:Math.random()<.5?1:2}}function ft(e){return e.doctorRules?.selfHealOffset??1}function ht(e){if(e.currentRound<=0)return!1;const r=ft(e);return e.currentRound<r?!1:(e.currentRound-r)%3===0}const pt=.75,_t=3,Pe=1.5,mt=pt,At=_t,ke={language:"pl",bulletSpeed:500,playerNodeScale:Pe};function yt(e){return Number.isNaN(e)?Pe:Math.min(At,Math.max(mt,e))}function se(e){const r=typeof e?.playerNodeScale=="number"?e.playerNodeScale:Pe;return{language:e?.language??ke.language,bulletSpeed:e?.bulletSpeed??ke.bulletSpeed,playerNodeScale:yt(r)}}function St(e){if(!e)return[];let r=!1;const n=e.map((t,i)=>typeof t.tunnelNumber=="number"?t:(r=!0,{...t,tunnelNumber:i+1}));return r?n:e}function Ct(e){if(!e?.length)return{normalized:e,changed:!1};let r=!1;const n=e.map(t=>{let i=t,a=!1;return Array.isArray(t.inactiveCards)||(i={...i,inactiveCards:t.inactiveCards?[...t.inactiveCards]:[]},a=!0),typeof i.status.timeLordSkipUsed>"u"&&(i={...i,status:{...i.status,timeLordSkipUsed:!1}},a=!0),typeof i.status.jailerAbilityUsed>"u"&&(i={...i,status:{...i.status,jailerAbilityUsed:!1}},a=!0),a?(r=!0,i):t});return{normalized:r?n:e,changed:r}}const bt=new Set(["Jailer","Gravedigger","Matrix","SwampMonster","Sniper","Sock","BlindExecutioner"]),It=new Set(["Jailer","SwampMonster","Sniper","Sock","BlindExecutioner"]);function X(e){const{normalized:r,changed:n}=Ct(e.players||[]),t=se(e.settings),i=!e.settings||e.settings.language!==t.language||e.settings.bulletSpeed!==t.bulletSpeed||e.settings.playerNodeScale!==t.playerNodeScale,a=St(e.globalTunnels),s=a!==e.globalTunnels,o=Array.isArray(e.publicReport)?e.publicReport:[],u=e.publicReportsByRound??(o.length?{[e.currentRound]:o}:{}),l=u!==e.publicReportsByRound,c=e.nightCache??le();c.pendingShots?(c.pendingShots.mafiaVotes=c.pendingShots.mafiaVotes??[],c.pendingShots.madGunman=c.pendingShots.madGunman??[],c.pendingShots.sniper=c.pendingShots.sniper??[]):c.pendingShots={mafiaVotes:[],madGunman:[],sniper:[]};const g=!c.leechLinks||!c.cobraTargets||!c.glazierPendingRewards||!Array.isArray(c.wokenPlayerIds)||typeof c.spyglassRevealIds>"u"||!Array.isArray(c.bulletAnimations)||!Array.isArray(c.jailerUsedIds)||!Array.isArray(c.blockedCardInstanceKeys)||!Array.isArray(c.nightCardOrder)||typeof c.nightCardCursor!="number"?{...c,leechLinks:c.leechLinks??[],cobraTargets:c.cobraTargets??[],glazierPendingRewards:c.glazierPendingRewards??[],wokenPlayerIds:c.wokenPlayerIds??[],spyglassRevealIds:c.spyglassRevealIds??null,bulletAnimations:c.bulletAnimations??[],jailerUsedIds:c.jailerUsedIds??[],blockedCardInstanceKeys:c.blockedCardInstanceKeys??[],nightCardOrder:c.nightCardOrder??[],nightCardCursor:typeof c.nightCardCursor=="number"?c.nightCardCursor:0}:c,E=g!==e.nightCache,N={waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null,pendingDayReport:null,communistSuppressionActive:!1,bulletReplayNonce:0,pendingVictoryKey:null},K=!e.uiState||typeof e.uiState.pendingDayReport>"u"||typeof e.uiState.communistSuppressionActive>"u"||typeof e.uiState.bulletReplayNonce>"u"||typeof e.uiState.pendingVictoryKey>"u",T=e.uiState||{},G=K?{...N,...T,pendingDayReport:T.pendingDayReport??null,communistSuppressionActive:T.communistSuppressionActive??!1,bulletReplayNonce:T.bulletReplayNonce??0,pendingVictoryKey:T.pendingVictoryKey??null}:e.uiState,B=G!==e.uiState,y=typeof e.victory>"u"?null:e.victory,p=e.victory!==y;return!i&&!s&&!E&&!l&&!n&&!B&&!p?e:{...e,players:n?r:e.players,settings:i?t:e.settings,globalTunnels:s?a:e.globalTunnels,nightCache:E?g:e.nightCache,publicReportsByRound:l?u:e.publicReportsByRound,uiState:B?G:e.uiState,victory:p?y:e.victory}}function kt(e){return{past:e.past.map(X),present:X(e.present),future:e.future.map(X)}}function le(){return{kuskonaTriggered:!1,gandalfTriggered:!1,leechLinks:[],cobraTargets:[],gravediggerActive:[],gravediggerBonus:{},slimeUsedOnPlayers:[],matrixStoredBullets:0,matrixTrap:null,glazierPendingRewards:[],pendingShots:{mafiaVotes:[],madGunman:[],sniper:[]},pendingToxicSocks:[],doctorProtections:[],executionerPairs:[],reportData:gn(),bulletReportLookup:{},spyglassRevealIds:null,wokenPlayerIds:[],bulletAnimations:[],jailerUsedIds:[],blockedCardInstanceKeys:[],nightCardOrder:[],nightCardCursor:0}}function fn(e,r){const n=_(e.players,r);if(!n||!n.status.isAlive)return{healer:null,canSelf:!1,hasTargets:!1,isDeactivated:!0};const t=ht(e),i=vt(e,n,t),s=e.players.some(o=>!(!o.status.isAlive||o.id===n.id&&!t))||i;return{healer:n,canSelf:t,hasTargets:s,isDeactivated:i}}function Qe(e){return e.cards.some(r=>r.cardId==="Mafia")}function vt(e,r,n){if(!r||!r.status.isAlive)return!0;if(n)return!1;const t=e.players.filter(s=>s.status.isAlive),i=t.filter(Qe).length;return i===0||t.length-i!==1?!1:!Qe(r)}function Et(e,r,n,t,i){e.nightCache.doctorProtections||(e.nightCache.doctorProtections=[]),e.nightCache.doctorProtections.push({healerId:r,targetId:n,instance:t.instance,mode:i})}function Nt(e){const r=[...e];for(let n=r.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[r[n],r[t]]=[r[t],r[n]]}return r}function Tt(e,r){if(!r)return;e.nightCache.wokenPlayerIds||(e.nightCache.wokenPlayerIds=[]);const n=_(e.players,r);if(n&&(e.nightCache.wokenPlayerIds.includes(n.id)||e.nightCache.wokenPlayerIds.push(n.id),r.cardId==="Spyglass"&&!e.nightCache.spyglassRevealIds)){const t=Array.from(new Set(e.nightCache.wokenPlayerIds));e.nightCache.spyglassRevealIds=Nt(t)}}function Oe(e,r){return r?e.nightCache.jailerUsedIds?.includes(r)??!1:!1}function Mt(e,r){r&&(e.nightCache.jailerUsedIds||(e.nightCache.jailerUsedIds=[]),e.nightCache.jailerUsedIds.includes(r)||e.nightCache.jailerUsedIds.push(r))}function hn(e,r){if(!e)return null;const n=r??"unknown",t=typeof e.instance=="number"?e.instance:"0",i=e.mode??"DEFAULT";return`${n}:${e.cardId}:${t}:${i}`}function qe(e,r,n){const t=hn(r,n);t&&(e.nightCache.blockedCardInstanceKeys||(e.nightCache.blockedCardInstanceKeys=[]),e.nightCache.blockedCardInstanceKeys.includes(t)||e.nightCache.blockedCardInstanceKeys.push(t))}function Rt(e,r,n){const t=hn(r,n);return t?e.nightCache.blockedCardInstanceKeys?.includes(t)??!1:!1}function wt(e,r){if(!r)return!1;const n=_(e.players,r);return Rt(e,r,n?.id)?!0:r.cardId==="Jailer"?!n||!n.status.isAlive||n.status.jailerAbilityUsed?!0:Oe(e,n.id):!1}function xt(e,r=!1){const n=e.nightCache.nightCardOrder;if(!r&&Array.isArray(n)&&n.length>0){const s=typeof e.nightCache.nightCardCursor=="number"?e.nightCache.nightCardCursor:0;return{order:n,cursor:s}}const i=ot(e);let a=0;if(!r&&e.activeCard){const s=i.findIndex(o=>o.cardId===e.activeCard?.cardId&&o.instance===e.activeCard?.instance&&o.mode===e.activeCard?.mode);a=s>=0?s+1:0}return{order:i,cursor:a}}function pn(e,r){const{order:n,cursor:t}=xt(e,r?.forceRebuild??!1);let i=t,a=null;for(;i<n.length;){const s=n[i];if(i+=1,!wt(e,s)){a=s;break}}return{card:a,order:n,nextCursor:i}}function Pt(e){const r=e.nightCache.leechLinks||[];if(!r.length){e.nightCache.leechLinks=[];return}r.forEach(n=>{if(!n.triggered)return;const t=e.players.find(a=>a.id===n.leechId&&a.status.isAlive);if(!t)return;const i=z(e.players,t,"CloudWalker");e.nightCache.reportData.cloudwalkers.leech.push(i),P(e,"Leech",n.instance,t.name,"log_night_leech_cloudwalker",{num:i})}),e.nightCache.leechLinks=[]}function Ot(e){const r=e.nightCache.cobraTargets||[];if(!r.length){e.nightCache.cobraTargets=[];return}r.forEach(n=>{const t=e.players.find(o=>o.id===n.cobraId&&o.status.isAlive);if(!t)return;const i=e.players.find(o=>o.id===n.targetId&&o.status.isAlive);if(!i||!an(i,"Leech"))return;const s=z(e.players,t,"CloudWalker");e.nightCache.reportData.cloudwalkers.cobra.push(s),P(e,"Cobra",n.instance,t.name,"log_night_cobra_cloudwalker",{num:s})}),e.nightCache.cobraTargets=[]}function Lt(e){const r=e.nightCache.gravediggerActive;r?.length&&(r.forEach(({playerId:n,instance:t})=>{const i=e.nightCache.gravediggerBonus[n]||0;if(i<=0)return;const a=e.players.find(s=>s.id===n);if(!(!a||!a.status.isAlive))for(let s=0;s<i;s++){const o=z(e.players,a,"CloudWalker");e.nightCache.reportData.cloudwalkers.gravedigger.push({num:o,cardInstance:t}),P(e,"Gravedigger",t,a.name,"log_night_cloudwalker_gain",{num:o})}}),e.nightCache.gravediggerActive=[],e.nightCache.gravediggerBonus={})}function Dt(e){const r=e.nightCache.glazierPendingRewards;r?.length&&(r.forEach(n=>{const t=e.players.find(s=>s.id===n&&s.status.isAlive);if(!t)return;const i=z(e.players,t,"Mirror");e.nightCache.reportData.cloudwalkers.glazier.push(i);const a=t.cards.find(s=>s.cardId==="Glazier")?.instance;P(e,"Glazier",a,t.name,"log_night_glazier_mirror",{num:i})}),e.nightCache.glazierPendingRewards=[])}function jt(e){e.players.forEach(r=>{r.status.isJailed&&(r.status.isJailed=!1)})}function Q(e){Pt(e),Ot(e),Lt(e),Dt(e),jt(e),q(e,"NIGHT_END",e.currentRound);const r=ut(e),t={...e.publicReportsByRound||{},[e.currentRound]:r},i={...e.nightCache,bulletAnimations:[],jailerUsedIds:[],blockedCardInstanceKeys:[],nightCardOrder:[],nightCardCursor:0},a=Z({...e,phase:"DAY_ANNOUNCEMENT",publicReport:r,publicReportsByRound:t,nightCache:i},null);return q(a,"DAY_START",a.currentRound),a}function ve(e){return(e.nightCache.bulletAnimations||[]).length>0?{...e,phase:"NIGHT_REPLAY",activeCard:null,uiState:{...e.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null,bulletReplayNonce:0}}:Q(e)}function ye(e){q(e,"DAY_END",e.currentRound);const r=e.players.map(t=>({...t,status:{...t.status,isJailed:!1,isSlimed:!1,isSanded:!1,isMagnetized:!1,isSilenced:!1,isCantVote:!1,executionerStatus:"NONE"}})),n={...e,players:r,phase:"NIGHT_ANNOUNCEMENT",currentRound:e.currentRound+1,globalTunnels:[],publicReport:[],nightCache:le(),activeCard:null,uiState:{waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null,pendingDayReport:null,communistSuppressionActive:!1,bulletReplayNonce:0,pendingVictoryKey:null}};return q(n,"NIGHT_START",n.currentRound),n}function Se(e,r){e.includes(r)||e.push(r)}function m(e,r,n,t="ACTION"){const i=$(n??{},e.players,e.settings.language),a=j(r,e.settings.language,i);e.logs.push({id:Math.random().toString(),timestamp:Date.now(),phase:e.phase,round:e.currentRound,text:a,translationKey:r,translationParams:n,type:t})}const Ze={NIGHT_START:"log_divider_night_start",NIGHT_END:"log_divider_night_end",DAY_START:"log_divider_day_start",DAY_END:"log_divider_day_end"};function q(e,r,n){const t=typeof n=="number"?{round:n}:void 0,a=[...e.logs||(e.logs=[])].reverse().find(s=>s.translationKey===Ze[r]);if(a){const s=typeof a.translationParams?.round=="number"?a.translationParams.round:a.round,o=typeof n=="number"?n:e.currentRound;if(s===o)return}m(e,Ze[r],t,"SYSTEM")}function ee(e,r){return e.players.filter(n=>n.status.isAlive&&n.cards.some(t=>t.cardId===r))}function Kt(e){return ee(e,"Anarchist").find(r=>!r.status.anarchistShotUsed)||null}function Gt(e){return ee(e,"Terrorist").find(r=>!r.status.terroristBombUsed)||null}function Bt(e){return ee(e,"Astronomer").find(r=>!r.status.astronomerNightUsed)||null}function Ut(e){return ee(e,"Communist").find(r=>!r.status.communistEqualityUsed)||null}function Ht(e){return ee(e,"TimeLord").find(r=>!r.status.timeLordSkipUsed)||null}function L(e,r){e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:r?[r.promptKey]:[],selectionContext:null,dayAction:r}}function Ft(e){if(!e)return null;switch(e.type){case"ROPEWALKER":return{key:"public_report_day_ropewalker_lost",params:{num:e.instance}};case"IMMUNITY":return{key:"public_report_day_immunity_lost",params:{num:e.instance}};case"KEVLAR":return{key:"public_report_day_kevlar_lost",params:{num:e.instance}};case"CLOUDWALKER":return{key:"public_report_day_cloudwalker_lost",params:{num:e.instance}};case"DEATH":return{key:"public_report_day_player_left",params:{name:e.playerName}};default:return null}}function ae(e,r){const n=r.map(Ft).filter(t=>!!t);e.uiState.pendingVictoryKey&&(n.push({key:e.uiState.pendingVictoryKey}),e.uiState={...e.uiState,pendingVictoryKey:null}),n.length&&(e.uiState={...e.uiState,pendingDayReport:n})}function h(e){return JSON.parse(JSON.stringify(e))}function Vt(e){if(!e.victory||e.phase==="GAME_OVER")return e;const r=e.victory.side==="MAFIA"?"victory_mafia":"victory_innocent";if(e.victory.announced||(m(e,r,{},"SYSTEM"),e.victory={...e.victory,announced:!0}),e.victory.cause==="NIGHT"){const n=Q(e);return{...n,phase:"GAME_OVER",activeCard:null,uiState:{...n.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null}}}return{...e,phase:"GAME_OVER",activeCard:null,uiState:{...e.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null}}}function Wt(e){return!e||e.cardId==="Matrix"?!1:e.cardId==="Gravedigger"}const $e={Jailer:["wake_up_jailer"],Mage:["wake_up_mage_from","wake_up_mage_to"],Slime:["wake_up_slime"],Leech:["wake_up_leech"],Sand:["wake_up_sand"],Cobra:["wake_up_cobra"],Magnet:["wake_up_magnet"],GhostBobo:["wake_up_ghost"],Doctor:["wake_up_doctor_heal_self","wake_up_doctor_heal_other"],Mafia:["wake_up_shooter"],MadGunman:["wake_up_shooter"],Sniper:["wake_up_shooter"],BlindExecutioner:["wake_up_executioner_save","wake_up_executioner_victim"],Judge:["wake_up_judge"],Sock:["wake_up_sock_first","wake_up_sock_second"],SwampMonster:["wake_up_swamp_monster"]};function zt(e,r){if(!r)return!1;if(r.cardId==="Spyglass")return!0;if(r.mode==="MATRIX_SHOT")return!1;if(r.cardId==="Matrix"){const n=_(e.players,r);if(!n||n.status.matrixAbilityUsed)return!1}if(r.cardId==="BlindExecutioner")return mn(e,r);if(r.cardId==="SwampMonster"){const n=_(e.players,r);if(!n||!n.status.isAlive||n.status.swampChargesLeft<=0)return!1}if(r.cardId==="Jailer"){const n=_(e.players,r);if(!n||!n.status.isAlive||n.status.jailerAbilityUsed||Oe(e,n.id))return!1}return bt.has(r.cardId)}function _n(e,r){if(!r)return[];if(r.cardId==="Doctor"){const n=fn(e,r);return n.hasTargets?[n.canSelf?"wake_up_doctor_heal_self":"wake_up_doctor_heal_other"]:[]}if(r.cardId==="BlindExecutioner"&&!mn(e,r))return[];if(r.cardId==="SwampMonster"){const n=_(e.players,r);if(!n||!n.status.isAlive||n.status.swampChargesLeft<=0)return[]}return $e[r.cardId]?[...$e[r.cardId]]:[]}function Yt(e,r,n){const t=Date.now(),i=e.globalTunnels.length+1,a={id:`tunnel-${t}-${Math.random().toString(36).slice(2,8)}`,sourceId:r,targetId:n,createdAt:t,tunnelNumber:i};return e.globalTunnels.push(a),a}function _(e,r){return r&&e.find(n=>n.cards.some(t=>t.cardId===r.cardId&&t.instance===r.instance))||null}function mn(e,r){if(!r||r.cardId!=="BlindExecutioner")return!1;const n=_(e.players,r);return!n||!n.status.isAlive||n.status.executionerUses>=2?!1:e.players.filter(i=>i.status.isAlive).length>=2}function P(e,r,n,t,i,a={}){const s={player:t,...a,cardLabel:v(r,n)},o=e.settings.language,u=j(i,o,$(s,e.players,o));e.logs.push({id:Math.random().toString(),timestamp:Date.now(),phase:e.phase,round:e.currentRound,text:u,translationKey:i,translationParams:s,type:"ACTION"})}function Jt(e,r){const n=e.filter(s=>s.status.isAlive);if(n.length<=1)return[];const t=n.findIndex(s=>s.id===r);if(t===-1)return[];const i=n[(t-1+n.length)%n.length],a=n[(t+1)%n.length];return i.id===a.id?[i]:[i,a]}function Xt(e,r,n){const t=_(e.players,r);if(!t)return;if(r.cardId==="Mafia"){const o=e.nightCache.pendingShots,u=o.mafiaVotes||(o.mafiaVotes=[]),l={shooterId:t.id,targetId:n},c=u.findIndex(d=>d.shooterId===t.id);c>=0?u[c]=l:u.push(l);return}const i=r.cardId==="Sniper"?e.nightCache.pendingShots.sniper:e.nightCache.pendingShots.madGunman,a={shooterId:t.id,instance:r.instance,targetId:n},s=i.findIndex(o=>o.shooterId===t.id&&o.instance===r.instance);s>=0?i[s]=a:i.push(a)}function en(e){const r=e.nightCache.pendingShots;return!!(r.mafiaVotes.length||r.madGunman.length||r.sniper.length)}function nn(e){return e.nightCache.pendingToxicSocks.length>0}function Qt(e){const r=e.nightCache.matrixTrap;if(!r)return null;const n=e.players.find(i=>i.id===r.playerId&&i.status.isAlive);return!n||!n.cards.some(i=>i.cardId==="Matrix"&&i.instance===r.instance)?null:{cardId:"Matrix",instance:r.instance,mode:"MATRIX_SHOT"}}function qt(e,r,n){const t=e.uiState.pendingPrompts[0],i=()=>{const a=e.uiState.pendingPrompts.slice(1);return e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:a,selectionContext:null},a.length===0?A(e):e};if(!t||t==="wake_up_mage_from"){const a=e.uiState.pendingPrompts.slice(1);return e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:a.length?a:["wake_up_mage_to"],selectionContext:{cardId:"Mage",data:{sourceId:r}}},e}if(t==="wake_up_mage_to"){const a=e.uiState.selectionContext?.data?.sourceId;if(!a)return e.uiState.selectionContext={cardId:"Mage",data:{sourceId:r}},e;if(a===r)return n("log_tunnel_same_player"),e;const s=e.players.find(c=>c.id===a)?.name||"?",o=e.players.find(c=>c.id===r),u=o?.name||"?";if(e.globalTunnels.some(c=>c.sourceId===a&&c.targetId===r))return n("log_tunnel_duplicate",{source:s,target:u}),i();if(o&&o.cards.some(c=>c.cardId==="Atheist"))return n("log_tunnel_atheist",{source:s,target:o.name}),i();const l=Yt(e,a,r);return n("log_tunnel_created",{source:s,target:u,tunnelNumber:l.tunnelNumber}),i()}return e}function Zt(e,r,n){const t=e.activeCard;if(!t)return e;const i=_(e.players,t);if(!i)return e;const a=e.players.find(c=>c.id===r&&c.status.isAlive);if(!a)return e;const s=e.uiState.pendingPrompts||[],o=e.uiState.selectionContext?.data?.savedId;if(!o)return e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:s.slice(1),selectionContext:{cardId:"BlindExecutioner",data:{savedId:r}}},e;if(o===r)return e;const u=e.players.find(c=>c.id===o&&c.status.isAlive);if(!u)return e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:s.slice(1),selectionContext:null},e.uiState.pendingPrompts.length===0?A(e):e;e.nightCache.executionerPairs||(e.nightCache.executionerPairs=[]),e.nightCache.executionerPairs.push({savedId:o,victimId:r}),u.status.executionerStatus="SAVED",a.status.executionerStatus="VICTIM",i.status.executionerUses=Math.min(2,i.status.executionerUses+1),n("log_night_executioner_save",{saved:u.name,victim:a.name});const l=s.slice(1);return e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:l,selectionContext:null},l.length===0?A(e):e}function $t(e,r,n){if(!e.activeCard)return e;const t=e.players.find(l=>l.id===r&&l.status.isAlive);if(!t)return e;const i=e.uiState.selectionContext?.cardId==="Sock"?e.uiState.selectionContext?.data?.firstTargetId:void 0;if(!i){const l=e.uiState.pendingPrompts.slice(1);return e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:l.length?l:["wake_up_sock_second"],selectionContext:{cardId:"Sock",data:{firstTargetId:r}}},e}if(i===r||!Jt(e.players,i).map(l=>l.id).includes(r))return e;const s=_(e.players,e.activeCard);if(!s)return e;e.nightCache.pendingToxicSocks.push({sockId:s.id,firstTargetId:i,secondTargetId:r}),sn(s,"Sock",e.activeCard.instance);const o=e.players.find(l=>l.id===i);n("log_action_sock_throw",{first:o?.name||"?",second:t.name});const u=e.uiState.pendingPrompts.slice(1);return e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:u,selectionContext:null},u.length===0?A(e):e}function ei(e,r,n){if(!e.activeCard)return e;const t=_(e.players,e.activeCard);if(!t||!t.status.isAlive||t.status.swampChargesLeft<=0)return e;const i=e.players.find(s=>s.id===r&&s.status.isAlive);if(!i)return e;i.status.mudCount=(i.status.mudCount||0)+1,t.status.swampChargesLeft=Math.max(0,t.status.swampChargesLeft-1),n("log_night_swamp_attack",{target:i.name});const a=(e.uiState.pendingPrompts||[]).slice(1);return t.status.swampChargesLeft>0?(e.uiState={...e.uiState,waitingFor:"USE_DECISION",pendingPrompts:["wake_up_use_again"],selectionContext:null},e):(e.uiState={...e.uiState,waitingFor:"NONE",pendingPrompts:a,selectionContext:null},a.length===0?A(e):e)}function Z(e,r){const n=zt(e,r),t=n?"USE_DECISION":"NONE",i=r&&!n?_n(e,r):[],a={...e,activeCard:r,uiState:{...e.uiState,waitingFor:t,pendingPrompts:i,selectionContext:null,dayAction:null}};return Tt(a,r),r?.cardId==="Doctor"&&!n&&i.length===0||r?.cardId==="BlindExecutioner"&&!n&&i.length===0?A(a):a}function ni(e){if(!(en(e)||e.nightCache.matrixStoredBullets>0||nn(e)))return ve(e);const n=h(e);en(n)&&Or(n);const t=n.nightCache.matrixStoredBullets>0;if(nn(n)&&Lr(n),t){const i=Qt(n);if(i){const a=_(n.players,i);return a&&P(n,"Matrix",i.instance,a.name,"log_night_matrix_bullet_summary",{count:n.nightCache.matrixStoredBullets}),Z({...n,phase:"NIGHT_ACTIVE"},i)}n.nightCache.matrixStoredBullets=0,n.nightCache.matrixTrap=null}return t||(n.nightCache.matrixTrap=null),ve(n)}function A(e){if(e.activeCard?.cardId==="Matrix"&&e.activeCard.mode==="MATRIX_SHOT"){if(e.nightCache.matrixStoredBullets>0)return Z(e,e.activeCard);const i={...e,nightCache:{...e.nightCache,matrixTrap:null}};return ve(i)}const n=pn(e),t={...e,nightCache:{...e.nightCache,nightCardOrder:n.order,nightCardCursor:n.nextCursor}};return n.card?Z(t,n.card):ni(t)}const ri={players:[],phase:"SETUP",currentRound:0,firstNightBriefingDone:!1,publicReport:[],publicReportsByRound:{},doctorRules:{selfHealOffset:1},activeCard:null,globalTunnels:[],nightCache:le(),uiState:{waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null,pendingDayReport:null,communistSuppressionActive:!1,bulletReplayNonce:0,pendingVictoryKey:null},logs:[],settings:se(ke),victory:null},xa={past:[],present:ri,future:[]};function ti(e,r){switch(r.type){case"START_GAME":{const{names:n,customDeck:t,language:i}=r.payload,a=n.map((u,l)=>({id:`p${l}`,name:u,cards:[],inactiveCards:[],hasGasMask:!1,status:{isAlive:!0,isJailed:!1,isSilenced:!1,isCantVote:!1,isSlimed:!1,isSanded:!1,isMagnetized:!1,mudCount:0,swampChargesLeft:0,matrixAbilityUsed:!1,gravediggerUsed:!1,massMurdererUsed:!1,jailerAbilityUsed:!1,executionerStatus:"NONE",executionerUses:0,anarchistShotUsed:!1,terroristBombUsed:!1,astronomerNightUsed:!1,communistEqualityUsed:!1,timeLordSkipUsed:!1}})),s=Xr(a,t),o={...e,players:s,phase:"NIGHT_ANNOUNCEMENT",currentRound:1,firstNightBriefingDone:!1,publicReport:[],publicReportsByRound:{},doctorRules:gt(),activeCard:null,nightCache:le(),uiState:{waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null,pendingDayReport:null,communistSuppressionActive:!1,bulletReplayNonce:0,pendingVictoryKey:null},settings:se({...e.settings,language:i}),logs:[{id:"0",timestamp:Date.now(),round:0,phase:"SETUP",text:j("log_start_game",i),translationKey:"log_start_game",translationParams:{},type:"SYSTEM"}],victory:null};return q(o,"NIGHT_START",o.currentRound),o}case"NEXT_PHASE":{if(e.phase==="NIGHT_ANNOUNCEMENT"){const n=e.currentRound===1&&!e.firstNightBriefingDone?{...e,firstNightBriefingDone:!0}:e,t={...n,nightCache:{...n.nightCache,nightCardOrder:[],nightCardCursor:0}},i=pn(t,{forceRebuild:!0}),a={...t,nightCache:{...t.nightCache,nightCardOrder:i.order,nightCardCursor:i.nextCursor}};return i.card?Z({...a,phase:"NIGHT_ACTIVE"},i.card):Q(a)}return e.phase==="NIGHT_ACTIVE"?A(e):e.phase==="NIGHT_REPLAY"?Q(e):e.phase==="DAY_ANNOUNCEMENT"?{...e,phase:"DAY_MAIN",uiState:{...e.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null}}:e.phase==="DAY_MAIN"?ye(e):e}case"REPLAY_BULLETS":{if(e.phase!=="NIGHT_REPLAY"||!e.nightCache.bulletAnimations?.length)return e;const n=h(e);return n.uiState={...n.uiState,bulletReplayNonce:n.uiState.bulletReplayNonce+1},n}case"CONFIRM_DAY_REPORT":{const n=e.uiState.pendingDayReport;if(!n?.length)return e;const t=h(e),i=t.publicReportsByRound||{},a=i[t.currentRound]??[];return t.publicReport=[...t.publicReport||[],...n],t.publicReportsByRound={...i,[t.currentRound]:[...a,...n]},t.uiState={...t.uiState,pendingDayReport:null},t}case"TRIGGER_VOTE":{if(e.phase!=="DAY_MAIN"||e.uiState.waitingFor==="USE_DECISION")return e;const n=h(e);return L(n,{kind:"HANG",promptKey:"day_prompt_vote"}),n}case"CONFIRM_MASS_MURDERER":{if(e.phase!=="DAY_MAIN")return e;const n=e.uiState.dayAction;if(!n||n.kind!=="MASS_MURDERER_RETALIATION")return e;const t=h(e),i=t.uiState.dayAction?.massMurderer;if(!i)return L(t,null),t;const a=t.players.find(l=>l.id===i.ownerId)||null,s=Array.from(new Set(i.selectedIds||[])),o=[];a&&(s.forEach(l=>{if(l===a.id)return;const c=t.players.find(d=>d.id===l);!c||!c.status.isAlive||(m(t,"log_day_mass_murderer_shot",{player:a.name,target:c.name}),o.push(W(t,c.id,"SHOOT")))}),a.status.massMurdererUsed=!0,an(a,"MassMurderer"));const u=n.targetId??a?.id??null;if(u){const c=t.players.find(d=>d.id===u)?.name||"?";m(t,"log_day_vote",{target:c}),o.push(W(t,u,"HANG"))}return ae(t,o),L(t,null),t}case"TRIGGER_ANARCHIST":{if(e.phase!=="DAY_MAIN"||e.uiState.waitingFor==="USE_DECISION")return e;const n=Kt(e);if(!n){const i=h(e);return m(i,"warn_anarchist_unavailable",{},"SYSTEM"),i}const t=h(e);return L(t,{kind:"ANARCHIST_SHOT",promptKey:"day_prompt_shot",actorId:n.id,consumeAnarchistCharge:!0,source:"ANARCHIST"}),t}case"GM_CLICK_PLAYER":{if(e.uiState.waitingFor==="USE_DECISION"||!r.payload)return e;if(e.phase==="NIGHT_ACTIVE"&&e.activeCard){const n=h(e),t=n.activeCard;if(!t)return e;const i=_(n.players,t),a=i?.name||"?",s=(c,d={})=>{P(n,t.cardId,t.instance,a,c,d)},o=(c=!1)=>{const d=(n.uiState.pendingPrompts||[]).slice(1),g=d.length===0;return n.uiState={...n.uiState,waitingFor:"NONE",pendingPrompts:d,selectionContext:c||g?null:n.uiState.selectionContext},g?A(n):n},u=r.payload;if(i?.status.isJailed)return qe(n,t,i.id),s("log_action_blocked_jailed",{player:a}),o(!0);if(t.cardId==="Mage")return qt(n,u,s);if(t.cardId==="BlindExecutioner")return Zt(n,u,s);if(t.cardId==="Sock")return $t(n,u,s);const l=n.players.find(c=>c.id===u);if(t.cardId==="Jailer"){if(!l||!l.status.isAlive)return e;l.status.isJailed=!0,i&&(i.status.jailerAbilityUsed=!0,Mt(n,i.id)),s("log_jailer_imprison",{target:l.name})}else if(t.cardId==="Mafia"||t.cardId==="MadGunman"||t.cardId==="Sniper")Xt(n,t,u),s("log_shooter_aim",{target:l?.name||"?"}),t.cardId==="Sniper"&&i&&sn(i,"Sniper",t.instance);else if(t.cardId==="Doctor"){const c=fn(n,t),d=c.healer;if(!d||!l||!l.status.isAlive||!c.hasTargets)return e;if(c.isDeactivated)return s("log_doctor_fail",{target:l.name}),o(!0);if(l.id===d.id&&!c.canSelf)return s("log_doctor_self_locked"),n;const g=l.id===d.id?"SELF":"OTHER";Et(n,d.id,l.id,t,g),s("log_doctor_success",{target:l.name})}else if(t.cardId==="Matrix"&&t.mode==="MATRIX_SHOT"){if(n.nightCache.matrixStoredBullets>0){const c=l?.name||"?";n.nightCache.matrixStoredBullets-=1;const d=_(n.players,t);Me(n,u,"MATRIX",d?.id||null,d?{shooterLabel:v("Matrix",t.instance),shooterName:d.name,initialTargetName:c}:void 0)}}else{const c=l;if(c&&c.status.isAlive){const d=n.nightCache.reportData;switch(t.cardId){case"Leech":{if(!i||!i.status.isAlive)break;n.nightCache.leechLinks||(n.nightCache.leechLinks=[]);const g=n.nightCache.leechLinks,E={leechId:i.id,instance:t.instance,targetId:c.id,triggered:!1},N=g.findIndex(K=>K.leechId===i.id&&K.instance===t.instance);N>=0?g[N]=E:g.push(E),s("log_action_leech",{target:c.name});break}case"Cobra":{if(!i||!i.status.isAlive)break;n.nightCache.cobraTargets||(n.nightCache.cobraTargets=[]),n.nightCache.cobraTargets.push({cobraId:i.id,instance:t.instance,targetId:c.id}),s("log_action_cobra",{name:c.name});break}case"Magnet":{if(!i||!i.status.isAlive)break;c.status.isMagnetized=!0,s("log_action_magnet",{name:c.name});break}case"Slime":c.status.isSlimed=!0,d.slimedTargets.push(c.id),s("log_action_slime",{target:c.name});break;case"Sand":c.hasGasMask?(d.sandProtectedTargets.push(c.id),s("log_action_sand_fail",{target:c.name})):(c.status.isSanded=!0,c.status.isSlimed=!1,Se(d.sandedTargets,c.id),s("log_action_sand",{target:c.name}));break;case"GhostBobo":c.status.isSilenced=!0,Se(d.ghostTargets,c.id),s("log_action_ghost",{target:c.name});break;case"Judge":c.status.isCantVote=!0,Se(d.judgeTargets,c.id),s("log_action_judge",{target:c.name});break;case"SwampMonster":return ei(n,u,s)}}}return o()}if(e.phase==="DAY_MAIN"){const n=e.uiState.dayAction;if(!n)return e;const t=h(e),i=r.payload,a=t.players.find(o=>o.id===i),s=a?.name||"?";if(n.kind==="MASS_MURDERER_RETALIATION"){const o=t.uiState.dayAction?.massMurderer;if(!o)return L(t,null),t;if(i===o.ownerId||!a||!a.status.isAlive)return e;const u=o.selectedIds||(o.selectedIds=[]),l=u.indexOf(i);return l>=0?u.splice(l,1):u.push(i),t}if(n.kind==="HANG"){if(a&&a.status.isAlive&&a.cards.some(u=>u.cardId==="MassMurderer")&&!a.status.massMurdererUsed){const u={kind:"MASS_MURDERER_RETALIATION",promptKey:"day_prompt_mass_murderer_select",source:"MASS_MURDERER",targetId:a.id,massMurderer:{ownerId:a.id,selectedIds:[]}};return m(t,"log_day_mass_murderer_trigger",{target:a.name}),L(t,u),t}m(t,"log_day_vote",{target:s});const o=W(t,i,"HANG");ae(t,[o])}else if(n.kind==="ANARCHIST_SHOT"){const o=W(t,i,"SHOOT"),u=n.actorId?t.players.find(l=>l.id===n.actorId):null;n.consumeAnarchistCharge&&u&&(u.status.anarchistShotUsed=!0),m(t,"log_day_shot",{target:s,actor:u?.name||j("role_Anarchist",t.settings.language)}),ae(t,[o])}return L(t,null),t}return e}case"GM_USE_DECISION":{if(e.phase!=="NIGHT_ACTIVE"||e.uiState.waitingFor!=="USE_DECISION"||!e.activeCard)return e;const n=e.activeCard;if(!r.payload){const s={...e,uiState:{...e.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null}};return A(s)}const t=_(e.players,n);if(n.cardId==="Jailer"&&t&&(t.status.jailerAbilityUsed||Oe(e,t.id))){const s={...e,uiState:{...e.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null}};return A(s)}if(t?.status.isJailed&&!It.has(n.cardId)){const s=h(e),o=_(s.players,n),u=o?.name||t.name||"?";return qe(s,n,o?.id??t.id),P(s,n.cardId,n.instance,u,"log_action_blocked_jailed",{player:u}),s.uiState={...s.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null},A(s)}if(n.cardId==="Matrix"&&n.mode!=="MATRIX_SHOT"){const s=h(e),o=_(s.players,n);return o&&!o.status.matrixAbilityUsed&&(o.status.matrixAbilityUsed=!0,s.nightCache.matrixTrap={playerId:o.id,instance:n.instance},P(s,"Matrix",n.instance,o.name,"log_night_matrix_activate")),s.uiState={...s.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null},A(s)}if(n.cardId==="Gravedigger"){const s=h(e),o=_(s.players,n);return o&&o.status.isAlive&&!o.status.gravediggerUsed&&(o.status.gravediggerUsed=!0,s.nightCache.gravediggerActive.push({playerId:o.id,instance:n.instance}),s.nightCache.gravediggerBonus[o.id]||(s.nightCache.gravediggerBonus[o.id]=0),P(s,"Gravedigger",n.instance,o.name,"log_player_activate")),s.uiState={...s.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null},A(s)}if(n.cardId==="Spyglass"){const s={...e,uiState:{...e.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null}};return A(s)}if(Wt(n)){const s={...e,uiState:{...e.uiState,waitingFor:"NONE",pendingPrompts:[],selectionContext:null,dayAction:null}};return A(s)}const i=_n(e,n),a={...e,uiState:{...e.uiState,waitingFor:"NONE",pendingPrompts:i,selectionContext:null,dayAction:null}};return n.cardId==="BlindExecutioner"&&i.length===0?A(a):a}case"UPDATE_SETTINGS":{const n=se({...e.settings,...r.payload});return e.settings.language===n.language&&e.settings.bulletSpeed===n.bulletSpeed&&e.settings.playerNodeScale===n.playerNodeScale?e:{...e,settings:n}}case"TRIGGER_ASTRONOMER":{if(e.phase!=="DAY_MAIN"){const a=h(e);return m(a,"warn_astronomer_day_only",{},"SYSTEM"),a}const n=Bt(e);if(!n){const a=h(e);return m(a,"warn_astronomer_unavailable",{},"SYSTEM"),a}const t=h(e),i=t.players.find(a=>a.id===n.id);return i?(i.status.astronomerNightUsed=!0,m(t,"log_day_astronomer",{player:i.name}),ye(t)):e}case"TRIGGER_COMMUNIST":{if(e.phase!=="DAY_MAIN"){const a=h(e);return m(a,"warn_communist_day_only",{},"SYSTEM"),a}const n=Ut(e);if(!n){const a=h(e);return m(a,"warn_communist_unavailable",{},"SYSTEM"),a}const t=h(e),i=t.players.find(a=>a.id===n.id);return i?(i.status.communistEqualityUsed=!0,t.players=t.players.map(a=>({...a,status:{...a.status,isSilenced:!1,isCantVote:!1}})),t.uiState={...t.uiState,communistSuppressionActive:!0},m(t,"log_day_communist",{player:i.name}),t):e}case"TRIGGER_TIMELORD_SKIP":{const n=r.payload.targetPhase==="NIGHT"?"NIGHT_ANNOUNCEMENT":"DAY_ANNOUNCEMENT";if(e.phase!==n)return e;const t=Ht(e);if(!t)return e;const i=h(e),a=i.players.find(o=>o.id===t.id);if(!a)return e;a.status.timeLordSkipUsed=!0;const s=r.payload.targetPhase==="NIGHT"?"log_timelord_skip_night":"log_timelord_skip_day";if(m(i,s,{player:a.name,cardLabel:v("TimeLord")}),r.payload.targetPhase==="NIGHT"){const o=i.currentRound===1&&!i.firstNightBriefingDone?{...i,firstNightBriefingDone:!0}:i;return Q(o)}return ye(i)}case"TRIGGER_BOMB":{if(e.phase!=="DAY_MAIN"){const o=h(e);return m(o,"warn_bomb_day_only",{},"SYSTEM"),o}const n=Gt(e);if(!n){const o=h(e);return m(o,"warn_terrorist_unavailable",{},"SYSTEM"),o}const t=h(e),i=t.players.find(o=>o.id===n.id);if(!i)return e;i.status.terroristBombUsed=!0,m(t,"log_day_bomb",{player:i.name});const a=t.players.filter(o=>o.status.isAlive).map(o=>o.id),s=[];return a.forEach(o=>{s.push(W(t,o,"SHOOT"))}),L(t,null),ae(t,s),t}}return e}function Pa(e,r){if(e.present.phase==="GAME_OVER"&&r.type!=="UNDO")return e;if(r.type==="LOAD_GAME")return kt(r.payload);if(r.type==="UNDO"){if(e.past.length===0)return e;const a=e.past[e.past.length-1],s=X(a),o=e.present.settings,u={...s,settings:{...o}};return{past:e.past.slice(0,-1),present:u,future:[]}}const n=ti(e.present,r),t=X(n),i=Vt(t);return e.present===i?e:r.type==="UPDATE_SETTINGS"?{...e,present:i,future:[]}:r.type==="REPLAY_BULLETS"?{...e,present:i,future:[]}:{past:[...e.past,e.present].slice(-50),present:i,future:[]}}const ii=_r,ai={CloudWalker:pr,Immunity:hr,RopeWalker:fr,KevlarVest:gr,Matrix:dr,Jailer:ur,Gravedigger:cr,Mage:lr,Slime:or,Leech:sr,Sand:ar,Cobra:ir,Magnet:tr,GhostBobo:rr,Doctor:nr,SwampMonster:er,Mafia:$n,MadGunman:Zn,Sniper:qn,Sock:Qn,Judge:Xn,BlindExecutioner:Jn,Spyglass:Yn,Mirror:zn,Terrorist:Wn,Astronomer:Vn,Meciar:Fn,Kovac:Hn,AlCapone:Un,Gandalf:Bn,HorsePiece:Gn,Atheist:Kn,Anarchist:jn,Glazier:Dn,MassMurderer:Ln,Communist:On,TimeLord:Pn};function Oa(e){return ai[e]??ii}const si="/mafia2/assets/alcapone-CY9h9jow.jfif",oi="/mafia2/assets/anarchist-BjlC44X8.jfif",li="/mafia2/assets/astronomer-BrMJTGrq.gif",ci="/mafia2/assets/atheist-B1pLtywD.jfif",ui="/mafia2/assets/blindexecutioner-869lL91T.png",di="/mafia2/assets/cloudwalker1-lFaUTZPr.jfif",gi="/mafia2/assets/cloudwalker2-BX-hlG2f.jfif",fi="/mafia2/assets/cloudwalker3-Dk7ulseU.jfif",hi="/mafia2/assets/cloudwalker4-D1bOGBE1.jfif",pi="/mafia2/assets/cloudwalker5-BpFCUra3.jfif",_i="/mafia2/assets/cloudwalker6-C_tz72mb.jfif",mi="/mafia2/assets/cloudwalker7-BDPeV42w.jfif",Ai="/mafia2/assets/cloudwalker1-lFaUTZPr.jfif",yi="/mafia2/assets/cloudwalker2-BX-hlG2f.jfif",Si="/mafia2/assets/cobra-D2CbZW9G.jfif",Ci="/mafia2/assets/communist-CZechumg.jpg",bi="/mafia2/assets/doctor-BAoW0T1S.jfif",Ii="/mafia2/assets/gandalf-CP21fVub.jfif",ki="/mafia2/assets/ghostbobo-DAjYs_sK.jfif",vi="/mafia2/assets/glazier-B7ZVY_Y_.jfif",Ei="/mafia2/assets/gravedigger-CxlzBvIV.jfif",Ni="/mafia2/assets/horsepiece-BoU0Xkil.jfif",Ti="/mafia2/assets/immunity1-B2NVHtPq.jfif",Mi="/mafia2/assets/immunity2-B_8EOuzJ.jfif",Ri="/mafia2/assets/jailer-B5CuRPNj.jfif",wi="/mafia2/assets/judge-C7QuGQ9B.jfif",xi="/mafia2/assets/kevlarvest1-CIrAoLIP.jfif",Pi="/mafia2/assets/kevlarvest2-CcKXzK0l.jfif",Oi="/mafia2/assets/kovac-rJ58tGnM.jfif",Li="/mafia2/assets/leech-dwRWTeEP.jpg",Di="/mafia2/assets/madgunman1-D4IKytZ6.jpg",ji="/mafia2/assets/madgunman2-Ev7sJbg9.jfif",Ki="/mafia2/assets/mafia1-BA9yO9IU.jfif",Gi="/mafia2/assets/mafia2-zL23fbdO.jfif",Bi="/mafia2/assets/mafia3-If7lxEyY.jfif",Ui="/mafia2/assets/mage1-BDRlirHk.gif",Hi="/mafia2/assets/mage2-3wSSgKR0.gif",Fi="data:application/octet-stream;base64,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",Vi="/mafia2/assets/magnet-Bd2Q5LRm.png",Wi="/mafia2/assets/massmurderer-BxXpzCg3.png",zi="/mafia2/assets/matrix-C13l_S_q.jfif",Yi="/mafia2/assets/meciar-C5aD0Nuj.png",Ji="/mafia2/assets/mirror1-Dz6Z9C7x.png",Xi="/mafia2/assets/mirror2-Bb1x54Ch.png",Qi="/mafia2/assets/mirror3-DMA6h8R2.jfif",qi="/mafia2/assets/mirror4-CFXrW3o9.jfif",Zi="/mafia2/assets/mirror5-CPwdUwkY.jfif",$i="/mafia2/assets/ropewalker1-B2q2BnSs.jfif",ea="/mafia2/assets/ropewalker2-DjeTU8D3.png",na="/mafia2/assets/ropewalker3-BVr4wHhC.jfif",ra="/mafia2/assets/sand-DotXyUfh.png",ta="/mafia2/assets/slime1-Bh5gDfiG.jfif",ia="/mafia2/assets/slime2-zXIf-fSs.jpg",aa="/mafia2/assets/sniper-DB66vLIO.jfif",sa="/mafia2/assets/sock-D3MWe0BL.jfif",oa="/mafia2/assets/spyglass-DgKLUXen.jfif",la="/mafia2/assets/swampmonster-aFsSeYu0.png",ca="/mafia2/assets/terrorist-B70yJo92.png",ua="/mafia2/assets/timelord-BO55vHUL.jfif",da=Object.assign({"../../icons/cards/alcapone.jfif":si,"../../icons/cards/anarchist.jfif":oi,"../../icons/cards/astronomer.gif":li,"../../icons/cards/atheist.jfif":ci,"../../icons/cards/blindexecutioner.png":ui,"../../icons/cards/cloudwalker1.jfif":di,"../../icons/cards/cloudwalker2.jfif":gi,"../../icons/cards/cloudwalker3.jfif":fi,"../../icons/cards/cloudwalker4.jfif":hi,"../../icons/cards/cloudwalker5.jfif":pi,"../../icons/cards/cloudwalker6.jfif":_i,"../../icons/cards/cloudwalker7.jfif":mi,"../../icons/cards/cloudwalker8.jfif":Ai,"../../icons/cards/cloudwalker9.jfif":yi,"../../icons/cards/cobra.jfif":Si,"../../icons/cards/communist.jpg":Ci,"../../icons/cards/doctor.jfif":bi,"../../icons/cards/gandalf.jfif":Ii,"../../icons/cards/ghostbobo.jfif":ki,"../../icons/cards/glazier.jfif":vi,"../../icons/cards/gravedigger.jfif":Ei,"../../icons/cards/horsepiece.jfif":Ni,"../../icons/cards/immunity1.jfif":Ti,"../../icons/cards/immunity2.jfif":Mi,"../../icons/cards/jailer.jfif":Ri,"../../icons/cards/judge.jfif":wi,"../../icons/cards/kevlarvest1.jfif":xi,"../../icons/cards/kevlarvest2.jfif":Pi,"../../icons/cards/kovac.jfif":Oi,"../../icons/cards/leech.jpg":Li,"../../icons/cards/madgunman1.jpg":Di,"../../icons/cards/madgunman2.jfif":ji,"../../icons/cards/mafia1.jfif":Ki,"../../icons/cards/mafia2.jfif":Gi,"../../icons/cards/mafia3.jfif":Bi,"../../icons/cards/mage1.gif":Ui,"../../icons/cards/mage2.gif":Hi,"../../icons/cards/mage3.jfif":Fi,"../../icons/cards/magnet.png":Vi,"../../icons/cards/massmurderer.png":Wi,"../../icons/cards/matrix.jfif":zi,"../../icons/cards/meciar.png":Yi,"../../icons/cards/mirror1.png":Ji,"../../icons/cards/mirror2.png":Xi,"../../icons/cards/mirror3.jfif":Qi,"../../icons/cards/mirror4.jfif":qi,"../../icons/cards/mirror5.jfif":Zi,"../../icons/cards/ropewalker1.jfif":$i,"../../icons/cards/ropewalker2.png":ea,"../../icons/cards/ropewalker3.jfif":na,"../../icons/cards/sand.png":ra,"../../icons/cards/slime1.jfif":ta,"../../icons/cards/slime2.jpg":ia,"../../icons/cards/sniper.jfif":aa,"../../icons/cards/sock.jfif":sa,"../../icons/cards/spyglass.jfif":oa,"../../icons/cards/swampmonster.png":la,"../../icons/cards/terrorist.png":ca,"../../icons/cards/timelord.jfif":ua}),J={};Object.entries(da).forEach(([e,r])=>{const t=(e.split("/").pop()??"").match(/^([a-z0-9]+?)(\d+)?\.(png|jpe?g|jfif|gif)$/i);if(!t)return;const[,i,a]=t,s=i.toLowerCase();if(J[s]||(J[s]=[]),a){const o=Math.max(0,Number(a)-1);J[s][o]=r}else J[s].push(r)});function ga(e){return e?e.filter(Boolean):[]}function fa(e){return e.toLowerCase()}function La(e,r=1){const n=fa(e),t=ga(J[n]);if(!t.length||r<1)return t[0]??null;const i=(r-1)%t.length;return t[i]??t[0]??null}const Da=["CloudWalker","Immunity","RopeWalker","KevlarVest","Matrix","Jailer","Mage","Slime","Leech","Sand","Cobra","Magnet","Sock","GhostBobo","Mafia","MadGunman","Sniper","Mirror","Terrorist","Astronomer","Meciar","Kovac","AlCapone","Gandalf","HorsePiece","Atheist","Anarchist","Glazier","MassMurderer","Judge","BlindExecutioner","Communist","Spyglass","Gravedigger","TimeLord","Doctor","SwampMonster"];export{Hr as C,Pe as D,Ia as L,_t as P,ka as R,pt as a,Oa as b,Na as c,cn as d,Ta as e,Ma as f,Ne as g,Ea as h,Ra as i,wa as j,we as k,va as l,La as m,on as n,Da as o,Pa as p,xa as q,ht as r,j as t};
